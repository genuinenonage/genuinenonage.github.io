<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="菜鸡">
<meta property="og:type" content="website">
<meta property="og:title" content="genuine nonage">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="genuine nonage">
<meta property="og:description" content="菜鸡">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="QB">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>genuine nonage</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">genuine nonage</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">减少放电，增加充电</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">QB</p>
  <div class="site-description" itemprop="description">菜鸡</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">74</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/28/linux/Linux%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QB">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="genuine nonage">
      <meta itemprop="description" content="菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | genuine nonage">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/28/linux/Linux%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">Linux命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-28 00:00:00" itemprop="dateCreated datePublished" datetime="2020-11-28T00:00:00+08:00">2020-11-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-08 18:41:21" itemprop="dateModified" datetime="2022-11-08T18:41:21+08:00">2022-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><h2 id="查找文件"><a href="#查找文件" class="headerlink" title="查找文件"></a>查找文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -iname &quot;node&quot;</span><br><span class="line">find / -type &quot; *.config &quot;</span><br></pre></td></tr></table></figure>

<h2 id="下载资源"><a href="#下载资源" class="headerlink" title="下载资源"></a>下载资源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://...</span><br></pre></td></tr></table></figure>

<h2 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h2><ul>
<li><p>tar.gz</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf xxx</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="移动文件"><a href="#移动文件" class="headerlink" title="移动文件"></a>移动文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv [源] [目标地址]</span><br></pre></td></tr></table></figure>

<h2 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rm xxx</span><br><span class="line">强制删除</span><br><span class="line">rm -f xxx</span><br><span class="line">删除文件夹</span><br><span class="line">rm -rf xxx</span><br><span class="line"></span><br><span class="line">排除显示当前文件夹的文件并未被排除的文件</span><br><span class="line">ls | grep -v cJKmhpmERdSoFhCX_Fm9yw | grep -v x9kg3vvoQZSzTLSt4m9BuQ | grep -v VVNb4OKkSoOTinXw7vSMsQ | grep -v pZrsvW6TRNqs_qXigFYkpA | grep -v yd4BNfvSS1enINMdeWNAyg |  xargs rm -rf</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="查看剩余空间"><a href="#查看剩余空间" class="headerlink" title="查看剩余空间"></a>查看剩余空间</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -h</span><br></pre></td></tr></table></figure>

<h2 id="启动软件命令"><a href="#启动软件命令" class="headerlink" title="启动软件命令"></a>启动软件命令</h2><h3 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">非root用户     ./elasticsearch -d</span><br></pre></td></tr></table></figure>

<h3 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">非root用户		nohup ./kibana &amp;</span><br></pre></td></tr></table></figure>

<h1 id="重要命令"><a href="#重要命令" class="headerlink" title="重要命令"></a>重要命令</h1><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><p>Linux grep 命令用于查找文件里符合条件的字符串。</p>
<p>grep 指令用于查找内容包含指定的范本样式的文件，如果发现某文件的内容符合所指定的范本样式，预设 grep 指令会把<strong>含有范本样式</strong>的那<strong>一列显示</strong>出来。若不指定任何文件名称，或是所给予的文件名为 **-**，则 grep 指令会从标准输入设备读取数据。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep [-abcEFGhHilLnqrsvVwxy][-A&lt;显示行数&gt;][-B&lt;显示列数&gt;][-C&lt;显示列数&gt;][-d&lt;进行动作&gt;][-e&lt;范本样式&gt;][-f&lt;范本文件&gt;][--help][范本样式][文件或目录...]</span><br></pre></td></tr></table></figure>

<p><strong>该命令经常以管道的方式使用：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat default.conf | grep -n  &quot;is&quot; | grep 127</span><br></pre></td></tr></table></figure>

<p>管道的意思就是将<code>|</code>前面命令的结果作为后面命令的输入内容。</p>
<h3 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h3><ul>
<li><strong>-n 或 –line-number</strong> : 在显示符合样式的那一行之前，标示出该行的列数编号。</li>
<li><strong>-o 或 –only-matching</strong> : 只显示匹配PATTERN 部分。</li>
<li><strong>-v 或 –invert-match</strong> : 显示不包含匹配文本的所有行。</li>
</ul>
<h1 id="系统操作"><a href="#系统操作" class="headerlink" title="系统操作"></a>系统操作</h1><h3 id="开机选项"><a href="#开机选项" class="headerlink" title="开机选项"></a>开机选项</h3><p>启动虚拟机会有两个选项</p>
<p><img src="https://i.loli.net/2020/12/11/OGVxFNMA7BI8lRc.png" alt="image.png"></p>
<p>第一个是正常启动</p>
<p>第二个是修改模式启动（出现问题的时候使用）</p>
<h3 id="关机"><a href="#关机" class="headerlink" title="关机"></a>关机</h3><p>立即关机</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown now</span><br></pre></td></tr></table></figure>

<p>10分钟后关机</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown -h 10</span><br></pre></td></tr></table></figure>

<h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><p>立即重启</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shutdown -r now</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>

<p>十分钟后重启</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown -r 10</span><br></pre></td></tr></table></figure>

<h3 id="图形界面"><a href="#图形界面" class="headerlink" title="图形界面"></a>图形界面</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><ol>
<li><p>开机root登录</p>
</li>
<li><p>安装X（X Window System）命令：</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall &quot;X Windwo System&quot;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>安装图形界面软件GNOME Desktop命令</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall &quot;GNOME Desktop&quot;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>安装完成，输入命令<code>startx</code>或者 <code>init 3</code>来进入图形界面，输入命令<code>init 5</code>进入命令行界面</li>
</ol>
<h4 id="设置开机启动"><a href="#设置开机启动" class="headerlink" title="设置开机启动"></a>设置开机启动</h4><p>查询当前所设定的状态。</p>
<p>multi-user.target 相当于以前的 level 3，也就是命令行终端；而 graphical.target 相当于以前的 level 5，也就是图形界面。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl get-default</span><br></pre></td></tr></table></figure>

<p>开机以命令模式启动，执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl set-default multi-user.target</span><br></pre></td></tr></table></figure>

<p>开机以图形界面启动，执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl set-default graphical.target</span><br></pre></td></tr></table></figure>

<h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><ol>
<li><p>root修改密码</p>
<p>直接输入passwd修改</p>
</li>
<li><p>用户修改密码</p>
<p>root用户输入passwd 用户名</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/25/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QB">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="genuine nonage">
      <meta itemprop="description" content="菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | genuine nonage">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/25/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/" class="post-title-link" itemprop="url">编程技巧</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-25 11:43:00" itemprop="dateCreated datePublished" datetime="2020-11-25T11:43:00+08:00">2020-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-02-08 15:15:27" itemprop="dateModified" datetime="2021-02-08T15:15:27+08:00">2021-02-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="JAVA"><a href="#JAVA" class="headerlink" title="JAVA"></a>JAVA</h2><h3 id="两个实体相同字段赋值"><a href="#两个实体相同字段赋值" class="headerlink" title="两个实体相同字段赋值"></a>两个实体相同字段赋值</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BeanUtils.copyProperties(map, addEntity);</span><br></pre></td></tr></table></figure>

<h3 id="遍历实体非空传入map"><a href="#遍历实体非空传入map" class="headerlink" title="遍历实体非空传入map"></a>遍历实体非空传入map</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();</span><br><span class="line">Field[] fields = addEntity.getClass().getDeclaredFields();</span><br><span class="line">for (Field f: fields) &#123;</span><br><span class="line">    f.setAccessible(true);</span><br><span class="line">    f.getName();</span><br><span class="line">    try &#123;</span><br><span class="line">        Object ob = f.get(addEntity);</span><br><span class="line">        if (null != ob)&#123;</span><br><span class="line">            properties.put(f.getName(), ob.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h3><p>注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ParamsCheck &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 此注解校验必传字段，判断需要字段是否为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">attributeName</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实体调用接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="meta">@ParamsCheck(attributeName = &quot;用户名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParamsCheck(attributeName = &quot;用户ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口的使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckPointParamsHandler</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Class clazz;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Field[] fields;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CheckPointParamsHandler</span><span class="params">(T t)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.t = t;</span><br><span class="line">        <span class="built_in">this</span>.clazz = t.getClass();</span><br><span class="line">        <span class="comment">//getDeclaredFields()返回Class中所有的字段，包括私有字段</span></span><br><span class="line">        <span class="comment">//getFields() 只返回公共字段，即有public修改的字段</span></span><br><span class="line">        <span class="built_in">this</span>.fields = t.getClass().getDeclaredFields();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断已经注解的字段是否为空</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">getParamChecksResults</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">R</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">R</span>();</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">for</span> (Field field :</span><br><span class="line">                fields) &#123;</span><br><span class="line">            <span class="comment">// 使用注解的必要字段不能为空--如果没有注解直接跳过</span></span><br><span class="line">            <span class="type">ParamsCheck</span> <span class="variable">annotation</span> <span class="operator">=</span> field.getAnnotation(ParamsCheck.class);</span><br><span class="line">            <span class="keyword">if</span> (annotation == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 判断使用注解的字段是否为空</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> field.getName();</span><br><span class="line">            <span class="type">char</span>[] tempChar = name.toCharArray();</span><br><span class="line">            tempChar[<span class="number">0</span>] -= <span class="number">32</span>;</span><br><span class="line">            <span class="comment">//获得方法名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">tempStr</span> <span class="operator">=</span> <span class="string">&quot;get&quot;</span> + String.valueOf(tempChar);</span><br><span class="line">            <span class="comment">//方法名为key，标签属性attributeName为value</span></span><br><span class="line">            map.put(tempStr, annotation.attributeName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry :</span><br><span class="line">                map.entrySet()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 获得方法的对象</span></span><br><span class="line">                <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getMethod(key);</span><br><span class="line">                <span class="comment">// 运行方法 获得属性的值</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">invoke</span> <span class="operator">=</span> method.invoke(t);</span><br><span class="line">                <span class="comment">// 校验属性的值是否为空</span></span><br><span class="line">                <span class="keyword">if</span> (invoke == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(invoke)) &#123;</span><br><span class="line">                    flag = <span class="literal">false</span>;</span><br><span class="line">                    sb.append(<span class="string">&quot;,&quot;</span>).append(value + <span class="string">&quot;不能为空&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag == <span class="literal">false</span>) &#123;</span><br><span class="line">            res = <span class="keyword">new</span> <span class="title class_">R</span>(sb.toString().substring(<span class="number">1</span>), <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res = <span class="keyword">new</span> <span class="title class_">R</span>(<span class="string">&quot;校验成功&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HashMap初始化多少"><a href="#HashMap初始化多少" class="headerlink" title="HashMap初始化多少"></a>HashMap初始化多少</h3><p>为避免扩容提高性能。</p>
<p>初始化的值为2的幂次方，并且需要注意负载因子（默认为0.75：如果输入7个，就不能初始化为8，应该为16）。</p>
<h2 id="Arango"><a href="#Arango" class="headerlink" title="Arango"></a>Arango</h2><h3 id="arange中查询数据"><a href="#arange中查询数据" class="headerlink" title="arange中查询数据"></a>arange中查询数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> organization</span><br><span class="line"><span class="keyword">filter</span> c.uuid<span class="operator">=</span><span class="operator">=</span>&quot;528971722846769152&quot;</span><br><span class="line"><span class="keyword">return</span> c</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/19/Elasticsearch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QB">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="genuine nonage">
      <meta itemprop="description" content="菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | genuine nonage">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/19/Elasticsearch/" class="post-title-link" itemprop="url">Elasticsearch使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-19 09:41:00" itemprop="dateCreated datePublished" datetime="2020-11-19T09:41:00+08:00">2020-11-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-03-17 18:54:29" itemprop="dateModified" datetime="2021-03-17T18:54:29+08:00">2021-03-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>Elasticsearch 是一个分布式、可扩展、实时的搜索与数据分析引擎。</p>
<p>Elasticsearch 是一个建立在全文搜索引擎 Apache Lucene(TM) 基础上的搜索引擎，可以说 Lucene 是当今最先进，最高效的全功能开源搜索引擎框架。</p>
<p>Elasticsearch 是一个<strong>分布式文档储存中间件</strong>，将信息储存<strong>已序列化为 JSON 文档的复杂数据结构</strong>。</p>
<p>当你在一个集群中有多个节点时，储存的文档分布在整个集群里面，并且立刻可以从任意节点去访问。</p>
<p>当文档被储存时，它将建立索引并且近实时（1s）被搜索。 Elasticsearch 使用一种被称为<strong>倒排索引</strong>的数据结构，该结构支持快速全文搜索。</p>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul>
<li>可扩展高达PB级的结构化和非结构化数据。</li>
<li>可以用来替代MongoDB和RavenDB等做文档存储。</li>
<li>使用非标准化来提高搜索性能。</li>
<li>是受欢迎的企业搜索引擎之一，目前被许多大型组织使用，如Wikipedia，The Guardian，StackOverflow，GitHub等。</li>
<li>Elasticsearch是开放源代码，可在Apache许可证版本<code>2.0</code>下提供。</li>
</ul>
<h3 id="Lucene与Elasticsearch关系？"><a href="#Lucene与Elasticsearch关系？" class="headerlink" title="Lucene与Elasticsearch关系？"></a>Lucene与Elasticsearch关系？</h3><p>Lucene不是一个完整的全文检索引擎，而是一个全文检索引擎的架构，提供了完整的查询引擎和索引引擎，部分文本分析引擎。想要使用，必须使用Java将其直接集成到应用中，非常复杂，需要深入了解检索的相关知识来理解它是如何工作的。</p>
<h3 id="与Solr性能对比"><a href="#与Solr性能对比" class="headerlink" title="与Solr性能对比"></a>与Solr性能对比</h3><ul>
<li>对已有数据查询，solr更快。</li>
<li>建立索引是，se更快。</li>
<li>随着数据增加时，se远快于solr，se更适合于实时搜索。</li>
</ul>
<p>为什么搜索引擎远大于传统搜索：<strong>倒排索引</strong>。当数据导入se的时候，就会做分词，在搜索的时候也会分词，将同分词的数据传出。</p>
<h2 id="主要概念"><a href="#主要概念" class="headerlink" title="主要概念"></a>主要概念</h2><ul>
<li>节点：它指的是Elasticsearch的单个正在运行的实例。单个物理和虚拟服务器容纳多个节点，这取决于其物理资源的能力，如RAM，存储和处理能力。</li>
<li>集群：它是一个或多个节点的集合。 集群为整个数据提供跨所有节点的集合索引和搜索功能。</li>
<li>索引：它是不同类型的文档和文档属性的集合。索引还使用分片的概念来提高性能。 例如，一组文档包含社交网络应用的数据。</li>
<li>类型/映射：共享同一索引中存在的一组公共字段的文档的集合。</li>
<li>文档：它是以JSON格式定义的特定方式的字段集合。每个文档都属于一个类型并驻留在索引中。每个文档都与唯一标识符(称为UID)相关联。</li>
<li>碎片：索引被水平细分为碎片。这意味着每个碎片包含文档的所有属性，但包含的数量比索引少。水平分隔使碎片成为一个独立的节点，可以存储在任何节点中。主碎片是索引的原始水平部分，然后这些主碎片被复制到副本碎片中。</li>
<li>副本： Elasticsearch允许用户创建其索引和分片的副本。 复制不仅有助于在故障情况下增加数据的可用性，而且还通过在这些副本中执行并行搜索操作来提高搜索的性能。</li>
</ul>
<h2 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h2><ul>
<li>基于Java开发的，平台兼容性</li>
<li>实时的，一秒钟后，添加的文档可以在这个引擎中搜索得到。</li>
<li>分布式的，易于在任何大型组织中扩展和集成。</li>
<li>通过使用Elasticsearch中的网关概念，创建完整备份很容易。</li>
<li>与Apache Solr相比，在Elasticsearch中处理多租户非常容易。</li>
<li>Elasticsearch使用JSON对象作为响应，这使得可以使用不同的编程语言调用Elasticsearch服务器。</li>
<li>Elasticsearch支持几乎大部分文档类型，但不支持文本呈现的文档类型。</li>
</ul>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ul>
<li>Elasticsearch在处理请求和响应数据方面没有多语言和数据格式支持(仅在JSON中可用)，与Apache Solr不同，Elasticsearch不可以使用CSV，XML等格式。</li>
<li>Elasticsearch也有一些伤脑的问题发生，虽然在极少数情况下才会发生。</li>
</ul>
<h2 id="ES和RDBMS之间的比较"><a href="#ES和RDBMS之间的比较" class="headerlink" title="ES和RDBMS之间的比较"></a>ES和RDBMS之间的比较</h2><p><img src="https://i.loli.net/2020/11/19/Ur4yMzp5sev6Idx.jpg" alt="Elasticsearch和RDBMS之间的比较.jpg"></p>
<h1 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h1><ol>
<li><p>安装jdk，要求版本7及以上</p>
</li>
<li><p>下载Elasticsearch</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/elasticsearch</span><br><span class="line">tar zxvf elasticsearch-7.4.2-linux-x86_64.tar.gz -C /usr/local/elasticsearch/</span><br><span class="line">cd /usr/local/elasticsearch/</span><br></pre></td></tr></table></figure></li>
<li><p>windows-解压zip包</p>
</li>
<li><p>进入到ES主目录和bin文件夹，windows运行elasticsearch.bt文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">cd</span> elasticsearch-x.x.x/bin</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">elasticsearch</span></span><br></pre></td></tr></table></figure></li>
<li><p>Elasticsearch Web界面的默认端口是<code>9200</code>，或者可以通过更改<code>bin</code>目录中的<code>elasticsearch.yml</code>文件中的<code>http.port</code>字段值来更改。可以通过浏览<code>http:// localhost:9200</code>来检查服务器是否已启动并正在运行。如果没有问题，它将返回一个JSON对象，其中包含有关安装的Elasticsearch信息有以下方式 </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;DESKTOP-PTE31DC&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cluster_name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;elasticsearch&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cluster_uuid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;tBLwR6ofTeqdakp88Y_WTw&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;7.6.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_flavor&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;zip&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_hash&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;aa751e09be0a5072e8570670309b1f12348f023b&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_date&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2020-02-29T00:15:25.529771Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_snapshot&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lucene_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;8.4.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;minimum_wire_compatibility_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;6.8.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;minimum_index_compatibility_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tagline&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>可以再Windows cmd中使用curl 进行交互</p>
</li>
<li><p>Linux安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/elasticsearch</span><br><span class="line">tar zxvf elasticsearch-7.3.1-linux-x86_64.tar.gz -C /usr/local/elasticsearch/</span><br><span class="line">cd /usr/local/elasticsearch</span><br><span class="line">cd bin/</span><br><span class="line">./elasticsearch</span><br><span class="line"></span><br><span class="line">如果jdk版本有问题需要</span><br><span class="line">cd jdk/</span><br><span class="line">复制路径</span><br><span class="line">pwd</span><br><span class="line">cd bin/</span><br><span class="line">使用自带的jdk</span><br><span class="line">vim elasticsearch-env</span><br><span class="line">JAVA_HOME=&quot;/usr/local/elasticsearch/elasticsearch-x.x.x/jdk/&quot;</span><br><span class="line">./elasticsearch</span><br><span class="line"></span><br><span class="line">不能使用root用户启动，需要创建新的用户组和用户</span><br><span class="line">groupadd es</span><br><span class="line">useradd es -g es</span><br><span class="line">su es</span><br><span class="line">su root</span><br><span class="line">root用户来授权</span><br><span class="line">chown -Rf es:es /usr/local/elasticsearch/</span><br><span class="line">su es</span><br><span class="line">./elasticsearch</span><br><span class="line"></span><br><span class="line">复制会话查看详情</span><br><span class="line">ps -ef|grep elasticsearch</span><br><span class="line">curl http://127.0.0.1:9200</span><br><span class="line"></span><br><span class="line">问题：远程浏览器使用需要配置</span><br><span class="line">cd config/</span><br><span class="line">vim elasticsearch.yml</span><br><span class="line"></span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">问题1</span><br><span class="line">vim /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line">es soft nofile 65535</span><br><span class="line">es hard nofile 65535</span><br><span class="line">es soft nproc 4096</span><br><span class="line">es hard nproc 4096</span><br><span class="line">问题2</span><br><span class="line">vim /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">vm.max_map_count = 262144</span><br><span class="line"></span><br><span class="line">sysctl -p</span><br><span class="line">问题3</span><br><span class="line">vim config/elasticsearch.yml</span><br><span class="line"></span><br><span class="line">discovery.seed_hosts: [&quot;81.70.204.157&quot;]</span><br><span class="line">cluster.initial_master_nodes: [&quot;81.70.204.157&quot;]</span><br><span class="line"></span><br><span class="line">问题4</span><br><span class="line">vim config/jvm.options</span><br><span class="line"></span><br><span class="line">把-XX:+UseConcMarkSweepGC注释</span><br><span class="line">添加-XX:+UseG1GC</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="搭建集群环境"><a href="#搭建集群环境" class="headerlink" title="搭建集群环境"></a>搭建集群环境</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/elasticsearch/es1</span><br><span class="line"></span><br><span class="line">tar zxvf elasticsearch-7.3.1-linux-x86_64.tar.gz -C /usr/local/elasticsearch/es1/</span><br><span class="line"></span><br><span class="line">cd /usr/local/elasticsearch/es1/</span><br><span class="line"></span><br><span class="line">vim config/elasticsearch.yml</span><br><span class="line">cluster.name: es # 集群名称，同一集群要一致</span><br><span class="line">node.name: node-1 # 集群下各节点名称</span><br><span class="line">http.port: 9200 # 端口</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">跨域请求配置（为了让类似<span class="built_in">head</span>的第三方插件可以请求es）</span></span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">集群发现配置</span></span><br><span class="line">discovery.seed_hosts: [&quot;81.70.204.157&quot;, &quot;81.70.204.157&quot;, &quot;81.70.204.157&quot;]</span><br><span class="line">cluster.initial_master_nodes: [&quot;node-1&quot;, &quot;node-2&quot;, &quot;node-3&quot;]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">连接超时时间</span></span><br><span class="line">discovery.zen.ping_timeout: 60s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">复制es1</span><br><span class="line">cp -Rf es1 es2</span><br><span class="line">cp -Rf es1 es3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">问题：如果内存不够需要调整</span><br><span class="line">-Xms512m</span><br><span class="line">-Xms512m</span><br><span class="line"></span><br><span class="line">http://81.70.204.157:9200/_cluster/health?pretty</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="Elasticsearch-插件安装"><a href="#Elasticsearch-插件安装" class="headerlink" title="Elasticsearch 插件安装"></a>Elasticsearch 插件安装</h1><h2 id="可视化工具"><a href="#可视化工具" class="headerlink" title="可视化工具"></a>可视化工具</h2><ol>
<li>head</li>
<li>cerebro</li>
<li>elasticHD</li>
</ol>
<h2 id="安装head"><a href="#安装head" class="headerlink" title="安装head"></a>安装head</h2><ol>
<li><p>安装git</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install git</span><br></pre></td></tr></table></figure></li>
<li><p>安装node.js</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/node</span><br><span class="line">tar xvf node-v12.13.1-linux-x64.tar.xz -C /usr/local/node</span><br><span class="line"></span><br><span class="line">cd /usr/local/node/node-v12.13.1-linux-x64/</span><br><span class="line">复制路径</span><br><span class="line">pwd  </span><br><span class="line">vim etc/profile</span><br><span class="line">配置环境变量</span><br><span class="line">export NODE_HOME=/usr/local/node/node-v12.13.1-linux-x64</span><br><span class="line">export PATH=$PATH:$NODE_HOME/bin</span><br><span class="line"></span><br><span class="line">重新加载环境变量</span><br><span class="line">source /etc/profile</span><br><span class="line">查看版本</span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br><span class="line">安装cnpm</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>安装head</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/elasticsearch/plugins</span><br><span class="line">cd /usr/local/elasticsearch/plugins</span><br><span class="line">git clone git://github.com/mobz/elasticsearch-head.git</span><br></pre></td></tr></table></figure></li>
<li><p>修改配置插件</p>
<p>进入elasticsearch-head目录，修改Gruntfile.js文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/elasticsearch/plugins/elasticsearch-head/</span><br><span class="line">vim Gruntfile.js</span><br></pre></td></tr></table></figure>

<p>添加hostname: ‘*’</p>
<p><img src="https://i.loli.net/2020/12/04/8BCXVIlYyvJoGtR.png" alt="image.png"></p>
</li>
<li><p>安装和启动</p>
<p>在elasticsearch-head目录下执行 npm install 安装(或者 cnpm install )，完成后在elasticsearch-head目录下执行 npm run start 运行head插件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm run start</span><br><span class="line">或者</span><br><span class="line">npm run start &amp; # 后台启动</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="状态："><a href="#状态：" class="headerlink" title="状态："></a>状态：</h3><p>green</p>
<p>yellow 有坏的分片但是能取到完整的数据</p>
<p>red 有坏的分片，不能取出完整的数据</p>
<h3 id="分片："><a href="#分片：" class="headerlink" title="分片："></a>分片：</h3><p>主分片（head中加粗的） 索引设置的分片</p>
<p>备用分片    副本树倍数的副本分片</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="新建索引："><a href="#新建索引：" class="headerlink" title="新建索引："></a>新建索引：</h3><p>es_head     test</p>
<h3 id="创建与修改document"><a href="#创建与修改document" class="headerlink" title="创建与修改document:"></a>创建与修改document:</h3><p><img src="https://i.loli.net/2020/12/04/Ly9mnG7XzMuxEgc.png" alt="image.png"></p>
<p>索引名字是：es_head，本记录的id是：1；</p>
<p>返回的信息：版本号是1，同一条记录修改一次就追加1。</p>
<p>一条记录就提交到ES中建立了索引，注意HTTP的方法是PUT，PUT需要指定 _id 插入数据，否则报错。POST无需指定 _id 插入数据，会使用随机值。</p>
<p><img src="https://i.loli.net/2020/12/04/qO2lWfm1gBHKkL7.png" alt="image.png"></p>
<p>更新接口与创建接口完全一样，ES会查询记录是否存在，如果不存在就是创建，存在就是更新操作。PUT操作必须指定 _id ，否则报错， _id 存在则为更新否则新增。POST操作无需指定 _id ，会使用随机值， _id 存在则为更新否则新增。</p>
<h3 id="查询document"><a href="#查询document" class="headerlink" title="查询document"></a>查询document</h3><p>查询全部</p>
<p><img src="https://i.loli.net/2020/12/04/9sj8UVpDTKLhAdn.png" alt="image.png"></p>
<p>根据_id查询</p>
<p><img src="https://i.loli.net/2020/12/04/9akoENCMHtlWjnR.png" alt="image.png"></p>
<p>found 值为true，表明查询到该文档， _source 字段是文档的内容。</p>
<h3 id="删除document"><a href="#删除document" class="headerlink" title="删除document"></a>删除document</h3><p><img src="https://i.loli.net/2020/12/04/rjwfHZ1MQOEpyTh.png" alt="image.png"></p>
<h2 id="Kibana使用"><a href="#Kibana使用" class="headerlink" title="Kibana使用"></a>Kibana使用</h2><p>Kibana是一个软件，不是插件。</p>
<p>Kibana是一款开源的数据分析和可视化平台，用于和ES协作。可以使用Kibana对ES索引中的数据进行搜索、查看、交互操作。可以很方便利用图表、表格及地图对数据进行多元化的分析和呈现。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>下载地址：<a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/kibana">https://www.elastic.co/cn/downloads/kibana</a></p>
<p>创建文件夹并解压</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/kibana</span><br><span class="line">tar -zxvf kibana-7.4.2-linux-x86_64.tar.gz -C /usr/local/kibana/</span><br></pre></td></tr></table></figure>

<p>修改kibana.yml配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim config/kibana.yml</span><br></pre></td></tr></table></figure>

<p>修改以下三处内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务端口，默认5601</span></span><br><span class="line">server.port: 5601</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">允许访问IP</span></span><br><span class="line">server.host: &quot;0.0.0.0&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置 elasticsearch 节点及端口</span></span><br><span class="line">elasticsearch.hosts: [&quot;http://81.70.204.157:9200&quot;, &quot;http://81.70.204.157:9201&quot;, &quot;http://81.70.204.157:9202&quot;]</span><br></pre></td></tr></table></figure>

<p>启动kibana（需要先启动es）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin/kibana --allow-root</span><br><span class="line">nohup bin/kibana  &amp; --allow-root</span><br></pre></td></tr></table></figure>

<p>访问：<a target="_blank" rel="noopener" href="http://106.15.248.56/:5601/">http://106.15.248.56/:5601/</a></p>
<p>关闭后台</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fuser -n tcp 9201</span><br><span class="line">kill 9201</span><br></pre></td></tr></table></figure>



<p><strong>关联索引库</strong> 这个索引必须要有数据才行。</p>
<p><img src="https://i.loli.net/2020/12/04/fGgkFcMXi7bdsen.png" alt="image.png"></p>
<p><strong>操作索引库</strong></p>
<p>通过Discover查询</p>
<p>通过Dev Tools查询</p>
<p><img src="https://i.loli.net/2020/12/04/DH2xXKOzB9NeIFm.png" alt="image.png"></p>
<h2 id="IK-Analysis中文分词器"><a href="#IK-Analysis中文分词器" class="headerlink" title="IK Analysis中文分词器"></a>IK Analysis中文分词器</h2><p>两种力度：ik_smart 粗粒度，ik_max_word 细粒度；</p>
<p>两种类型 </p>
<p>text 数据类型用来索引长文本：分词，建立索引，允许ES来检索词语。不能用来排序和聚合。</p>
<p>Keyword 类型用来建立电子邮箱地址、姓名、邮政编码和标签等数据，不需要进行分词，可以用来检索、过滤、排序和聚合。只能本身进行检索。</p>
<p>ES是分词分到什么，才能搜索到什么。否则搜索不到。</p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建ik目录</span></span><br><span class="line">mkdir -p /usr/local/elasticsearch/es1/elasticsearch-7.4.2/plugins/ik</span><br><span class="line">mkdir -p /usr/local/elasticsearch/es2/elasticsearch-7.4.2/plugins/ik</span><br><span class="line">mkdir -p /usr/local/elasticsearch/es3/elasticsearch-7.4.2/plugins/ik</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压至ik目录</span></span><br><span class="line">unzip elasticsearch-analysis-ik-7.4.2.zip -d</span><br><span class="line">/usr/local/elasticsearch/es1/elasticsearch-7.4.2/plugins/ik/</span><br><span class="line">unzip elasticsearch-analysis-ik-7.4.2.zip -d</span><br><span class="line">/usr/local/elasticsearch/es2/elasticsearch-7.4.2/plugins/ik/</span><br><span class="line">unzip elasticsearch-analysis-ik-7.4.2.zip -d</span><br><span class="line">/usr/local/elasticsearch/es3/elasticsearch-7.4.2/plugins/ik/</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -Rf es:es /usr/local/elasticsearch/</span><br></pre></td></tr></table></figure>

<p>重启ES</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>创建索引库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT http://81.70.204.157:9200/ik -H &#x27;Content-Type:application/json&#x27; -d&#x27;&#123;</span><br><span class="line">&quot;settings&quot;: &#123;</span><br><span class="line">&quot;number_of_shards&quot;: 5,</span><br><span class="line">&quot;number_of_replicas&quot;: 1 &#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>设置mapping</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST http://81.70.204.157:9200/ik/_mapping -H &#x27;Content-Type:application/json&#x27; -d&#x27;&#123;</span><br><span class="line">&quot;properties&quot;: &#123;</span><br><span class="line">&quot;content&quot;: &#123;</span><br><span class="line">&quot;type&quot;: &quot;text&quot;,</span><br><span class="line">&quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">&quot;search_analyzer&quot;: &quot;ik_smart&quot;&#125;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>导入数据：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST http://localhost:9200/ik/_create/1 -H &#x27;Content-Type:application/json&#x27; -d&#x27; &#123;&quot;content&quot;:&quot;美国留给伊拉克的是个烂摊子吗&quot;&#125; &#x27;</span><br><span class="line">curl -XPOST http://localhost:9200/ik/_create/2 -H &#x27;Content-Type:application/json&#x27; -d&#x27; &#123;&quot;content&quot;:&quot;公安部：各地校车将享最高路权&quot;&#125; &#x27;</span><br><span class="line">curl -XPOST http://localhost:9200/ik/_create/3 -H &#x27;Content-Type:application/json&#x27; -d&#x27; &#123;&quot;content&quot;:&quot;中韩渔警冲突调查：韩警平均每天扣1艘中国渔船&quot;&#125; &#x27;</span><br><span class="line">curl -XPOST http://localhost:9200/ik/_create/4 -H &#x27;Content-Type:application/json&#x27; -d&#x27; &#123;&quot;content&quot;:&quot;中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首&quot;&#125; &#x27;</span><br></pre></td></tr></table></figure>

<p>测试查询</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET http://localhost:9200/ik/_search?pretty -H &#x27;Content-Type:application/json&#x27; -d&#x27;&#123;</span><br><span class="line">&quot;query&quot; : &#123; &quot;term&quot; : &#123; &quot;content&quot; : &quot;中国&quot;&#125;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>高亮查询</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET http://localhost:9200/ik/_search?pretty -H &#x27;Content-Type:application/json&#x27; -d&#x27;&#123;</span><br><span class="line">&quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;content&quot; : &quot;中国&quot; &#125;&#125;,</span><br><span class="line">&quot;highlight&quot; : &#123;</span><br><span class="line">&quot;pre_tags&quot; : [&quot;&lt;font color=red&gt;&quot;],</span><br><span class="line">&quot;post_tags&quot; : [&quot;&lt;/font&gt;&quot;],</span><br><span class="line">&quot;fields&quot; : &#123;</span><br><span class="line">&quot;content&quot; : &#123;&#125; &#125;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="Logstash"><a href="#Logstash" class="headerlink" title="Logstash"></a>Logstash</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>用于ES导入MySQL数据。</p>
<p>Logstash是开源的服务器端数据处理管道，能够同时从多个来源采集数据，转换数据，然后将数据发送到你最喜欢的ES数据库中。</p>
<h3 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h3><p>创建目录，解压至该目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/logstash</span><br><span class="line">tar -zxvf logstash-7.4.2.tar.gz -C /usr/local/logstash/</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/logstash/logstash-7.4.2</span><br><span class="line">bin/logstash -e &#x27;input &#123; stdin &#123;&#125; &#125; output &#123; stdout &#123;&#125; &#125;&#x27;</span><br><span class="line">使用 -e 参数在命令行中指定配置是一种方式，不过如果需要配置更多设置则需要很长的内容。这种情况，我们首先创建一个配置文件，并且指定logstash使用这个配置文件。标准配置为文件含有 input&#123;&#125;, filter&#123;&#125; 和 output&#123;&#125; 三部分。</span><br></pre></td></tr></table></figure>

<p><strong>导入MySQL数据过程，在此忽略</strong></p>
<h1 id="Elasticsearch的JavaAPI"><a href="#Elasticsearch的JavaAPI" class="headerlink" title="Elasticsearch的JavaAPI"></a>Elasticsearch的JavaAPI</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- elasticsearch 服务依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- rest-client 客户端依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- rest-high-level-client 客户端依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java连接Elasticsearch</strong></p>
<p>ES有两种连接方式：transport、rest。</p>
<p>transport通过TCP方式访问ES（只提供Java，已被删除）</p>
<p>rest方式通过http API 访问ES（没有语言限制）</p>
<p>Java High Level REST Client ,它是基于 Java Low Level REST Client 的封装，并且API接收参数和返回值和 TransportClient 是一样的，使得代码迁移变得容易并且支持了RESTful的风格，兼容了这两种客户端的优点。</p>
<p>缺点是版本的问题。ES的小版本更新非常频繁，在最理想的情况下，客户端的版本要和ES的版本一致（至少主版本号一致），次版本号不一致的话，基本操作也许可以，但是新API就不支持了。</p>
<h2 id="Java-High-Level-REST-Client"><a href="#Java-High-Level-REST-Client" class="headerlink" title="Java High Level REST Client"></a>Java High Level REST Client</h2><p>初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">        RestClient.builder(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;81.70.204.157&quot;</span>, <span class="number">9200</span>, <span class="string">&quot;http&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">9201</span>, <span class="string">&quot;http&quot;</span>)));</span><br></pre></td></tr></table></figure>

<p>关闭</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client.close();</span><br></pre></td></tr></table></figure>



<h2 id="ES基础操作"><a href="#ES基础操作" class="headerlink" title="ES基础操作"></a>ES基础操作</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticsearchTest</span> &#123;</span><br><span class="line">    <span class="comment">//ES服务器IP</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">HOST</span> <span class="operator">=</span> <span class="string">&quot;81.70.204.157&quot;</span>;</span><br><span class="line">    <span class="comment">//ES服务器连接方式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">SCHEME</span> <span class="operator">=</span> <span class="string">&quot;http&quot;</span>;</span><br><span class="line">    <span class="comment">//初始化ES服务集群</span></span><br><span class="line">    <span class="comment">//参数分别为：IP，端口，连接方式（默认为http）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> HttpHost[] httpHosts = &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">HttpHost</span>(HOST,<span class="number">9200</span>,SCHEME)</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//客户端</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取客户端</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getConnect</span><span class="params">()</span> &#123;</span><br><span class="line">        client = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(httpHosts));</span><br><span class="line">        System.out.println(<span class="string">&quot;获取客户端&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭连接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">closeConnect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != client) &#123;</span><br><span class="line">                client.close();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;关闭连接&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreate</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//准备数据</span></span><br><span class="line">        Map&lt;String, Object&gt; jsonMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        jsonMap.put(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        jsonMap.put(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        jsonMap.put(<span class="string">&quot;address&quot;</span>, <span class="string">&quot;first&quot;</span>);</span><br><span class="line">        <span class="comment">//指定索引库和id及数据</span></span><br><span class="line">        <span class="type">IndexRequest</span> <span class="variable">indexRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;ik&quot;</span>).id(<span class="string">&quot;5&quot;</span>).source(jsonMap);</span><br><span class="line">        <span class="comment">//执行请求</span></span><br><span class="line">        <span class="type">IndexResponse</span> <span class="variable">indexResponse</span> <span class="operator">=</span> client.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line">        System.out.println(indexResponse.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Map&lt;String, Object&gt; jsonMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        jsonMap.put(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        jsonMap.put(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>);</span><br><span class="line">        jsonMap.put(<span class="string">&quot;address&quot;</span>, <span class="string">&quot;second&quot;</span>);</span><br><span class="line">        <span class="comment">//指定索引库和id及数据</span></span><br><span class="line">        <span class="type">UpdateRequest</span> <span class="variable">updateRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">&quot;ik&quot;</span>, <span class="string">&quot;5&quot;</span>).doc(jsonMap);</span><br><span class="line">        <span class="comment">//执行请求</span></span><br><span class="line">        <span class="type">UpdateResponse</span> <span class="variable">updateResponse</span> <span class="operator">=</span> client.update(updateRequest, RequestOptions.DEFAULT);</span><br><span class="line">        System.out.println(updateResponse.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//指定索引库和id</span></span><br><span class="line">        <span class="type">DeleteRequest</span> <span class="variable">deleteRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(<span class="string">&quot;ik&quot;</span>, <span class="string">&quot;5&quot;</span>);</span><br><span class="line">        <span class="type">DeleteResponse</span> <span class="variable">deleteResponse</span> <span class="operator">=</span> client.delete(deleteRequest, RequestOptions.DEFAULT);</span><br><span class="line">        System.out.println(deleteResponse.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量增删改操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCUD</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//初始化RulkRequest</span></span><br><span class="line">        <span class="type">BulkRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">        <span class="comment">//指定索引库和id及数据</span></span><br><span class="line">        <span class="comment">//批量添加</span></span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;ik&quot;</span>)</span><br><span class="line">                .id(<span class="string">&quot;6&quot;</span>)</span><br><span class="line">                .source(XContentType.JSON, <span class="string">&quot;username&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="number">18</span>));</span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;ik&quot;</span>)</span><br><span class="line">                .id(<span class="string">&quot;7&quot;</span>)</span><br><span class="line">                .source(XContentType.JSON, <span class="string">&quot;username&quot;</span>, <span class="string">&quot;lisi&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        <span class="comment">//批量修改</span></span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">&quot;ik&quot;</span>, <span class="string">&quot;7&quot;</span>)</span><br><span class="line">                .doc(XContentType.JSON, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;1&quot;</span>));</span><br><span class="line">        <span class="comment">//批量删除</span></span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(<span class="string">&quot;ik&quot;</span>, <span class="string">&quot;6&quot;</span>));</span><br><span class="line">        <span class="comment">//执行请求</span></span><br><span class="line">        <span class="type">BulkResponse</span> <span class="variable">bulkResponse</span> <span class="operator">=</span> client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line">        System.out.println(bulkResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量查询-查询所有</span></span><br><span class="line"><span class="comment">     * SearchSourceBuilder.query(QueryBuilders.matchallQuery());</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRetrieveAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//指定索引库</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;ik&quot;</span>);</span><br><span class="line">        <span class="comment">//构建查询对象</span></span><br><span class="line">        <span class="type">SearchSourceBuilder</span> <span class="variable">searchSourceBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        <span class="comment">//添加查询条件</span></span><br><span class="line">        searchSourceBuilder.query(QueryBuilders.matchAllQuery());</span><br><span class="line">        <span class="comment">//执行请求</span></span><br><span class="line">        searchRequest.source(searchSourceBuilder);</span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> client.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">//总条数</span></span><br><span class="line">        System.out.println(<span class="string">&quot;总条数：&quot;</span> + searchResponse.getHits().getTotalHits().value);</span><br><span class="line">        <span class="comment">//结果数据（如果不设置返回条数，大于十条默认值返回十条）</span></span><br><span class="line">        SearchHit[] hits = searchResponse.getHits().getHits();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;分数：&quot;</span> + hit.getScore());</span><br><span class="line">            Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(<span class="string">&quot;index -&gt; &quot;</span> + hit.getIndex());</span><br><span class="line">            System.out.println(<span class="string">&quot;id -&gt; &quot;</span> + hit.getId());</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; s : sourceAsMap.entrySet()) &#123;</span><br><span class="line">                System.out.println(s.getKey() + <span class="string">&quot; -- &quot;</span> + s.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;---------------------------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量查询-匹配查询</span></span><br><span class="line"><span class="comment">     * 匹配</span></span><br><span class="line"><span class="comment">     * SearchSourceBuilder.query(QueryBuilders.multiMatchQuery(value,key1,key2...))</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRetrieveMatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 指定索引库</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;ik&quot;</span>);</span><br><span class="line">        <span class="comment">// 构建查询对象</span></span><br><span class="line">        <span class="type">SearchSourceBuilder</span> <span class="variable">searchSourceBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        <span class="comment">// 添加查询条件</span></span><br><span class="line">        <span class="comment">// 指定从 content 和 goodsName 字段中查询</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;中国&quot;</span>;</span><br><span class="line">        searchSourceBuilder.query(QueryBuilders.multiMatchQuery(key, <span class="string">&quot;content&quot;</span>, <span class="string">&quot;goodsName&quot;</span>));</span><br><span class="line">        <span class="comment">// 执行请求</span></span><br><span class="line">        searchRequest.source(searchSourceBuilder);</span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> client.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">//总条数</span></span><br><span class="line">        System.out.println(<span class="string">&quot;总条数：&quot;</span> + searchResponse.getHits().getTotalHits().value);</span><br><span class="line">        <span class="comment">//结果数据（如果不设置返回条数，大于十条默认值返回十条）</span></span><br><span class="line">        SearchHit[] hits = searchResponse.getHits().getHits();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;分数：&quot;</span> + hit.getScore());</span><br><span class="line">            Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(<span class="string">&quot;index -&gt; &quot;</span> + hit.getIndex());</span><br><span class="line">            System.out.println(<span class="string">&quot;id -&gt; &quot;</span> + hit.getId());</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; s : sourceAsMap.entrySet()) &#123;</span><br><span class="line">                System.out.println(s.getKey() + <span class="string">&quot; -- &quot;</span> + s.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;---------------------------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量查询-分页查询-按分数或id排序</span></span><br><span class="line"><span class="comment">     * 分页</span></span><br><span class="line"><span class="comment">     * SearchSourceBuilder.form(page),size(pagesize);</span></span><br><span class="line"><span class="comment">     * 匹配</span></span><br><span class="line"><span class="comment">     * SearchSourceBuilder.query(QueryBuilders.multiMatchQuery(value,key1,key2...));</span></span><br><span class="line"><span class="comment">     * 默认排序</span></span><br><span class="line"><span class="comment">     * SearchSourceBuilder.sort(SortBuilders.scoreSort().order(SortOrder.ASC));</span></span><br><span class="line"><span class="comment">     * 字段配许</span></span><br><span class="line"><span class="comment">     * SearchSourceBuilder.sort(SortBuilders.fieldSort(key).order(SortOrder.ASC));</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRetrievePage</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 指定索引库</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;ik&quot;</span>);</span><br><span class="line">        <span class="comment">// 构建查询对象</span></span><br><span class="line">        <span class="type">SearchSourceBuilder</span> <span class="variable">searchSourceBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        <span class="comment">// 添加分页条件， 从第 0 个开始， 返回 5 个</span></span><br><span class="line">        searchSourceBuilder.from(<span class="number">0</span>).size(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">// 添加查询条件</span></span><br><span class="line">        <span class="comment">// 指定从 goodsName 字段中查询</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;中国&quot;</span>;</span><br><span class="line">        searchSourceBuilder.query(QueryBuilders.multiMatchQuery(key, <span class="string">&quot;content&quot;</span>));</span><br><span class="line">        <span class="comment">// 按照 score 正序排序（默认倒序）</span></span><br><span class="line"><span class="comment">//        searchSourceBuilder.sort(SortBuilders.scoreSort().order(SortOrder.ASC));</span></span><br><span class="line">        <span class="comment">// 并且按照 id 倒叙排序（分数字段会失效返回 NaN）</span></span><br><span class="line">        searchSourceBuilder.sort(SortBuilders.fieldSort(<span class="string">&quot;_id&quot;</span>).order(SortOrder.DESC));</span><br><span class="line">        <span class="comment">//执行请求</span></span><br><span class="line">        searchRequest.source(searchSourceBuilder);</span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> client.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">//总条数</span></span><br><span class="line">        System.out.println(<span class="string">&quot;总条数：&quot;</span> + searchResponse.getHits().getTotalHits().value);</span><br><span class="line">        <span class="comment">//结果数据（如果不设置返回条数，大于十条默认值返回十条）</span></span><br><span class="line">        SearchHit[] hits = searchResponse.getHits().getHits();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;分数：&quot;</span> + hit.getScore());</span><br><span class="line">            Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(<span class="string">&quot;index -&gt; &quot;</span> + hit.getIndex());</span><br><span class="line">            System.out.println(<span class="string">&quot;id -&gt; &quot;</span> + hit.getId());</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; s : sourceAsMap.entrySet()) &#123;</span><br><span class="line">                System.out.println(s.getKey() + <span class="string">&quot; -- &quot;</span> + s.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;---------------------------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量查询-分页查询-高亮查询</span></span><br><span class="line"><span class="comment">     * 高亮</span></span><br><span class="line"><span class="comment">     * SearchSourceBuilder.highlightBuilder(HighlightBuilder.field(key).preTags(&quot;&lt;span style=&#x27;color:red;&#x27;&gt;&quot;).postTags(&quot;&lt;/span&gt;&quot;));</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHighlight</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 指定索引库</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;ik&quot;</span>);</span><br><span class="line">        <span class="comment">// 构建查询对象</span></span><br><span class="line">        <span class="type">SearchSourceBuilder</span> <span class="variable">searchSourceBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        <span class="comment">// 添加分页条件， 从第 0 个开始， 返回 5 个</span></span><br><span class="line">        searchSourceBuilder.from(<span class="number">0</span>).size(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">// 构建高亮对象</span></span><br><span class="line">        <span class="type">HighlightBuilder</span> <span class="variable">highlightBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HighlightBuilder</span>();</span><br><span class="line">        highlightBuilder.field(<span class="string">&quot;content&quot;</span>)</span><br><span class="line">                .preTags(<span class="string">&quot;&lt;span style=&#x27;color:red;&#x27;&gt;&quot;</span>)</span><br><span class="line">                .postTags(<span class="string">&quot;&lt;/span&gt;&quot;</span>);</span><br><span class="line">        searchSourceBuilder.highlighter(highlightBuilder);</span><br><span class="line">        <span class="comment">// 添加查询条件</span></span><br><span class="line">        <span class="comment">// 指定从 goodsName 字段中查询</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;中国&quot;</span>;</span><br><span class="line">        searchSourceBuilder.query(QueryBuilders.multiMatchQuery(key, <span class="string">&quot;content&quot;</span>));</span><br><span class="line">        <span class="comment">//执行请求</span></span><br><span class="line">        searchRequest.source(searchSourceBuilder);</span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> client.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">//总条数</span></span><br><span class="line">        System.out.println(<span class="string">&quot;总条数：&quot;</span> + searchResponse.getHits().getTotalHits().value);</span><br><span class="line">        <span class="comment">//结果数据（如果不设置返回条数，大于十条默认值返回十条）</span></span><br><span class="line">        SearchHit[] hits = searchResponse.getHits().getHits();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">            <span class="comment">// 构建项目中所需的数据结果集</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> String.valueOf(hit.getHighlightFields().get(<span class="string">&quot;content&quot;</span>).fragments()[<span class="number">0</span>]);</span><br><span class="line"><span class="comment">//            Integer goodsId = Integer.valueOf((Integer) hit.getSourceAsMap().get(&quot;goodsId&quot;));</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">goodsName</span> <span class="operator">=</span> String.valueOf(hit.getSourceAsMap().get(<span class="string">&quot;content&quot;</span>));</span><br><span class="line"><span class="comment">//            BigDecimal marketPrice = new BigDecimal(String.valueOf(hit.getSourceAsMap().get(&quot;marketPrice&quot;)));</span></span><br><span class="line"><span class="comment">//            String originalImg = String.valueOf(hit.getSourceAsMap().get(&quot;originalImg&quot;));</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;goodsId -&gt; &quot; + goodsId);</span></span><br><span class="line">            System.out.println(<span class="string">&quot;content -&gt; &quot;</span> + content);</span><br><span class="line"><span class="comment">//            System.out.println(&quot;highlightMessage -&gt; &quot; + highightMessage);</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;marketPrice -&gt; &quot; + marketPrice);</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;originalImg -&gt; &quot; + originalImg);</span></span><br><span class="line">            System.out.println(<span class="string">&quot;----------------------------------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h1><p>阅读官方文档的好处，可以深入理解其内在机制。</p>
<h2 id="文档导航"><a href="#文档导航" class="headerlink" title="文档导航"></a>文档导航</h2><p>理解后面每一章节所要讲述的知识内容。</p>
<ul>
<li>基础入门：数据输入输出和处理文档数据。了解分布式处理过程。</li>
<li>深入搜索：使用更高级的特性，获取最佳的结果。</li>
<li>处理人类语言： 分词和查找人类语言棘手问题。</li>
<li>聚合：讨论聚合和分析。</li>
<li>地理位置：支持两种地理位置检索方式，经纬坐标点和复杂的地理形状。</li>
<li>数据模型：如何设计索引来匹配你系统中的数据流。</li>
<li>管理、监控和部署：生产环境上线的重要配置、监控点和如何诊断以避免出现问题。</li>
</ul>
<p>有时需要在<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">Elasticsearch 参考手册</a> 获取最新的参考手册和相关文档。</p>
<p>还需要到<a target="_blank" rel="noopener" href="http://elasticsearch.cn/">中文社区</a> 来学习别人的经验。</p>
<h1 id="知识点记录"><a href="#知识点记录" class="headerlink" title="知识点记录"></a>知识点记录</h1><h2 id="term-match-match-phase-query-string之间的区别"><a href="#term-match-match-phase-query-string之间的区别" class="headerlink" title="term,match,match_phase,query_string之间的区别"></a>term,match,match_phase,query_string之间的区别</h2><p>match：（分词部分匹配）模糊匹配，需要指定字段名，输入会进行分词，部分分词匹配到就会查询。</p>
<p>term：（精确查找分词，需要确定会有这个分词才行）需要指定字段名，输入不会分词，查询数据分词是否包含输入值。</p>
<p>match_phase：（等价于不分词，进行精确查找）需要指定字段名，输入会分词，结果包含全部分词，要求结果中包含分词且顺序是一样的。</p>
<p>query_string：（与match_phase基本相同，可以给输入值，所有字段中所有）可以不指定字段名，在所有字段中搜索，范围更广泛。</p>
<h2 id="ES的复杂查询"><a href="#ES的复杂查询" class="headerlink" title="ES的复杂查询"></a>ES的复杂查询</h2><h3 id="sql查询方式"><a href="#sql查询方式" class="headerlink" title="sql查询方式"></a>sql查询方式</h3><p>类似mysql语句</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST _sql?format=csv</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;select articleid from article_ignore_case where gettime between &#x27;2010-03-04 04:14:37&#x27; and &#x27;2021-03-10 04:14:37&#x27; or  content.original like &#x27;%Free Tibet%&#x27; or title.original like &#x27;%Free Tibet%&#x27; &quot;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="sql转ES-json查询方式"><a href="#sql转ES-json查询方式" class="headerlink" title="sql转ES-json查询方式"></a>sql转ES-json查询方式</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST _sql/translate</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;select articleid from article_ignore_case where gettime between &#x27;2010-03-04 04:14:37&#x27; and &#x27;2021-03-10 04:14:37&#x27; or  content.original = &#x27;%Free Tibet%&#x27; or title.original like &#x27;%Free Tibet%&#x27; order by gettime desc&quot;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="复杂查询json"><a href="#复杂查询json" class="headerlink" title="复杂查询json"></a>复杂查询json</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">GET article_ignore_case/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;content.original&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Free Tibet&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;title.original&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Free Tibet&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span>  </span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;gettime&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2010-03-04 04:14:37&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-03-01 04:14:37&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;content.original&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;title.original&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span>  </span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;content.trans&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;title.trans&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span>  </span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;website.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1tvnews.af&quot;</span></span><br><span class="line">                  <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;website.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2008xianzhang.info&quot;</span></span><br><span class="line">                  <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;content.original&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国世界&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title.original&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国世界&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span>  </span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;content.trans&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国世界&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title.trans&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国世界&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span>  </span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;gettime&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;categoryAttributes&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="nested查询方式"><a href="#nested查询方式" class="headerlink" title="nested查询方式"></a>nested查询方式</h2><p>es中如何查询存放的实体对象呢。</p>
<p>如果用不同类型的存储方式，存数据。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span>            </span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="string">&quot;12&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;李四&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="string">&quot;13&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;王五&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="string">&quot;13&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>如果使用下列的查询方式，是可以查到数据的</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /XXX/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;user.name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张三&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;user.age&quot;</span><span class="punctuation">:</span><span class="number">13</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>对象name和age的关联性消失了。</p>
<p>需要使用nested方式存数据，查数据。才能保证数据之间的关联性。</p>
<h3 id="nested-设置-mapping"><a href="#nested-设置-mapping" class="headerlink" title="nested 设置 mapping"></a>nested 设置 mapping</h3><p>在通常指定 object 类型的地方，改成 nested 类型</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">PUT /XXX</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;text&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;text&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;keyword&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;nested&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;text&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;short&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>再用以前的方法就搜索不到了</p>
<p>nested方式搜索：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">POST /XXX/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;nested&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">                                    <span class="punctuation">&#123;</span></span><br><span class="line">                                        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                                            <span class="attr">&quot;user.name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张三&quot;</span></span><br><span class="line">                                        <span class="punctuation">&#125;</span></span><br><span class="line">                                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="punctuation">&#123;</span></span><br><span class="line">                                        <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                                            <span class="attr">&quot;user.age&quot;</span><span class="punctuation">:</span><span class="number">12</span></span><br><span class="line">                                        <span class="punctuation">&#125;</span></span><br><span class="line">                                    <span class="punctuation">&#125;</span></span><br><span class="line">                                <span class="punctuation">]</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>









      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/18/MyBatis/MyBatis-Plus%E7%9A%84%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QB">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="genuine nonage">
      <meta itemprop="description" content="菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | genuine nonage">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/18/MyBatis/MyBatis-Plus%E7%9A%84%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">MyBatis-Plus的学习</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-18 10:43:00" itemprop="dateCreated datePublished" datetime="2020-11-18T10:43:00+08:00">2020-11-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-09-23 22:51:34" itemprop="dateModified" datetime="2022-09-23T22:51:34+08:00">2022-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MyBatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MyBatis/Mybatis-Plus/" itemprop="url" rel="index"><span itemprop="name">Mybatis-Plus</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>MyBatis-Plus(简称MP)是一个MyBatis的增强工具，在MyBatis的基础上只做增强不做改变，为简化开发、提高效率而生。</p>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li><strong>无侵入</strong>：只做增强不做改变，引入它不会对现有工程产生影响</li>
<li><strong>损耗小</strong>：启动即会自动注入基本 CURD，性能基本无损耗，直接面向对象操作</li>
<li><strong>强大的 CRUD 操作</strong>：内置通用Mapper、通用Service，仅仅通过少量配置即可实现单表大部分CRUD操作，强大的条件构造器，满足各类使用需求</li>
<li><strong>支持 Lambda 形式调用</strong>：通过 Lambda 表达式，方便的编写各类查询条件，无需再担心字段写错</li>
<li>。。。</li>
</ul>
<h3 id="框架结构"><a href="#框架结构" class="headerlink" title="框架结构"></a>框架结构</h3><p><img src="https://baomidou.com/img/mybatis-plus-framework.jpg" alt="framework"></p>
<h3 id="视频教程"><a href="#视频教程" class="headerlink" title="视频教程"></a>视频教程</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.imooc.com/learn/1130">MyBatis-Plus 入门 - 视频教程 - 慕课网</a></li>
<li><a target="_blank" rel="noopener" href="https://www.imooc.com/learn/1171">MyBatis-Plus 进阶 - 视频教程 - 慕课网</a></li>
</ul>
<h2 id="快速开发"><a href="#快速开发" class="headerlink" title="快速开发"></a>快速开发</h2><p><a target="_blank" rel="noopener" href="https://baomidou.com/guide/quick-start.html">快速开发链接</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>全新的 <code>MyBatis-Plus</code> 3.0 版本基于 JDK8，提供了 <code>lambda</code> 形式的调用，所以安装集成 MP3.0 要求如下：</p>
<h3 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h3><p>Maven：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h3><p>Maven:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Spring Boot 工程：</p>
<ul>
<li><p>配置 MapperScan 注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.baomidou.mybatisplus.samples.quickstart.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>Spring MVC 工程：</p>
<ul>
<li><p>配置 MapperScan</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.baomidou.mybatisplus.samples.quickstart.mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>调整 SqlSessionFactory 为 MyBatis-Plus 的 SqlSessionFactory</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><ul>
<li>@TableName</li>
<li>@TableId</li>
<li>@TableField</li>
<li>@Version</li>
<li>@EnumValue</li>
<li>@TableLogic</li>
<li>@SqlParser</li>
<li>@KeySequence</li>
</ul>
<h1 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h1><h2 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h2><p>AutoGenerator 是 MyBatis-Plus 的代码生成器，通过 AutoGenerator 可以快速生成 Entity、Mapper、Mapper XML、Service、Controller 等各个模块的代码，极大的提升了开发效率。</p>
<p><a target="_blank" rel="noopener" href="https://baomidou.com/guide/generator.html">代码生成器使用教程链接</a></p>
<h2 id="CRUD接口"><a href="#CRUD接口" class="headerlink" title="CRUD接口"></a>CRUD接口</h2><p><a target="_blank" rel="noopener" href="https://baomidou.com/guide/crud-interface.html">CRUD接口官方文档链接</a></p>
<ul>
<li>Service CRUD接口</li>
<li>Mapper CRUD 接口</li>
<li>mapper 层 选装件</li>
</ul>
<h2 id="条件构造器"><a href="#条件构造器" class="headerlink" title="条件构造器"></a>条件构造器</h2><p>说明：</p>
<blockquote>
<ul>
<li><p>出现的第一个入参<code>boolean condition</code>表示该条件<strong>是否</strong>加入最后生成的sql中</p>
</li>
<li><p>代码块内的多个方法均为从上往下补全个别<code>boolean</code>类型的入参,默认为<code>true</code></p>
</li>
<li><p>出现的泛型<code>Param</code>均为<code>Wrapper</code>的子类实例(均具有<code>AbstractWrapper</code>的所有方法)</p>
</li>
</ul>
</blockquote>
<h3 id="AbsractWrapper"><a href="#AbsractWrapper" class="headerlink" title="AbsractWrapper"></a>AbsractWrapper</h3><p>QueryWrapper(LambdaQueryWrapper) 和 UpdateWrapper(LambdaUpdateWrapper) 的父类<br>用于生成 sql 的 where 条件,entity属性也用于生成sql的where条件</p>
<p>注意：entity生成的where条件与使用各个api生成的where条件<strong>没有任何关联行为</strong></p>
<h4 id="allEq"><a href="#allEq" class="headerlink" title="allEq"></a>allEq</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">allEq(Map&lt;R, V&gt; params)</span><br><span class="line">allEq(Map&lt;R, V&gt; params, <span class="type">boolean</span> null2IsNull)</span><br><span class="line">allEq(<span class="type">boolean</span> condition, Map&lt;R, V&gt; params, <span class="type">boolean</span> null2IsNull)</span><br></pre></td></tr></table></figure>

<ul>
<li>全部<a target="_blank" rel="noopener" href="https://baomidou.com/guide/wrapper.html#eq">eq</a>(或个别<a target="_blank" rel="noopener" href="https://baomidou.com/guide/wrapper.html#isnull">isNull</a>)</li>
</ul>
<blockquote>
<p>个别参数说明:</p>
<p><code>params</code> : <code>key</code>为数据库字段名,<code>value</code>为字段值<br><code>null2IsNull</code> : 为<code>true</code>则在<code>map</code>的<code>value</code>为<code>null</code>时调用 <a target="_blank" rel="noopener" href="https://baomidou.com/guide/wrapper.html#isnull">isNull</a> 方法,为<code>false</code>时则忽略<code>value</code>为<code>null</code>的</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">allEq(BiPredicate&lt;R, V&gt; filter, Map&lt;R, V&gt; params)</span><br><span class="line">allEq(BiPredicate&lt;R, V&gt; filter, Map&lt;R, V&gt; params, <span class="type">boolean</span> null2IsNull)</span><br><span class="line">allEq(<span class="type">boolean</span> condition, BiPredicate&lt;R, V&gt; filter, Map&lt;R, V&gt; params, <span class="type">boolean</span> null2IsNull) </span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">allEq(BiPredicate&lt;R, V&gt; filter, Map&lt;R, V&gt; params)</span><br><span class="line">allEq(BiPredicate&lt;R, V&gt; filter, Map&lt;R, V&gt; params, <span class="type">boolean</span> null2IsNull)</span><br><span class="line">allEq(<span class="type">boolean</span> condition, BiPredicate&lt;R, V&gt; filter, Map&lt;R, V&gt; params, <span class="type">boolean</span> null2IsNull) </span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="eq"><a href="#eq" class="headerlink" title="eq"></a>eq</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eq(R column, Object val)</span><br><span class="line">eq(<span class="type">boolean</span> condition, R column, Object val)</span><br></pre></td></tr></table></figure>

<ul>
<li>等于 =</li>
<li>例: <code>eq(&quot;name&quot;, &quot;老王&quot;)</code>—&gt;<code>name = &#39;老王&#39;</code></li>
</ul>
<h4 id="ne"><a href="#ne" class="headerlink" title="ne"></a>ne</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ne(R column, Object val)</span><br><span class="line">ne(<span class="type">boolean</span> condition, R column, Object val)</span><br></pre></td></tr></table></figure>

<ul>
<li>不等于 &lt;&gt;</li>
<li>例: <code>ne(&quot;name&quot;, &quot;老王&quot;)</code>—&gt;<code>name &lt;&gt; &#39;老王&#39;</code></li>
</ul>
<h4 id="gt"><a href="#gt" class="headerlink" title="gt"></a>gt</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gt(R column, Object val)</span><br><span class="line">gt(<span class="type">boolean</span> condition, R column, Object val)</span><br></pre></td></tr></table></figure>

<ul>
<li>大于 &gt;</li>
<li>例: <code>gt(&quot;age&quot;, 18)</code>—&gt;<code>age &gt; 18</code></li>
</ul>
<h4 id="ge"><a href="#ge" class="headerlink" title="ge"></a>ge</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ge(R column, Object val)</span><br><span class="line">ge(<span class="type">boolean</span> condition, R column, Object val)</span><br></pre></td></tr></table></figure>

<ul>
<li>大于等于 &gt;=</li>
<li>例: <code>ge(&quot;age&quot;, 18)</code>—&gt;<code>age &gt;= 18</code></li>
</ul>
<h4 id="lt"><a href="#lt" class="headerlink" title="lt"></a>lt</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lt(R column, Object val)</span><br><span class="line">lt(<span class="type">boolean</span> condition, R column, Object val)</span><br></pre></td></tr></table></figure>

<ul>
<li>小于 &lt;</li>
<li>例: <code>lt(&quot;age&quot;, 18)</code>—&gt;<code>age &lt; 18</code></li>
</ul>
<h4 id="le"><a href="#le" class="headerlink" title="le"></a>le</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">le(R column, Object val)</span><br><span class="line">le(<span class="type">boolean</span> condition, R column, Object val)</span><br></pre></td></tr></table></figure>

<ul>
<li>小于等于 &lt;=</li>
<li>例: <code>le(&quot;age&quot;, 18)</code>—&gt;<code>age &lt;= 18</code></li>
</ul>
<h4 id="between"><a href="#between" class="headerlink" title="between"></a>between</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">between(R column, Object val1, Object val2)</span><br><span class="line">between(<span class="type">boolean</span> condition, R column, Object val1, Object val2)</span><br></pre></td></tr></table></figure>

<ul>
<li>BETWEEN 值1 AND 值2</li>
<li>例: <code>between(&quot;age&quot;, 18, 30)</code>—&gt;<code>age between 18 and 30</code></li>
</ul>
<h4 id="…"><a href="#…" class="headerlink" title="…."></a>….</h4><ul>
<li>notBetween</li>
<li>like</li>
<li>notLike</li>
<li>likeLeft</li>
<li>likeRight</li>
<li>isNull</li>
<li>isNotNull</li>
<li>in</li>
<li>notIn</li>
<li>inSql</li>
<li>notInSql</li>
<li>groupBy</li>
<li>orderByAsc</li>
<li>orderByDesc</li>
<li>orderBy</li>
<li>having</li>
<li>func</li>
<li>or</li>
<li>and</li>
<li>nested</li>
<li>apply</li>
<li>last</li>
<li>exists</li>
<li>notExists</li>
</ul>
<h3 id="QueryWrapper"><a href="#QueryWrapper" class="headerlink" title="QueryWrapper"></a>QueryWrapper</h3><blockquote>
<p>说明：</p>
<p>继承自 AbstractWrapper ,自身的内部属性 entity 也用于生成 where 条件及 LambdaQueryWrapper, 可以通过 new QueryWrapper().lambda() 方法获取</p>
</blockquote>
<h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select(String... sqlSelect)</span><br><span class="line">select(Predicate&lt;TableFieldInfo&gt; predicate)</span><br><span class="line">select(Class&lt;T&gt; entityClass, Predicate&lt;TableFieldInfo&gt; predicate)</span><br></pre></td></tr></table></figure>

<ul>
<li>设置查询字段</li>
</ul>
<blockquote>
<p>说明:</p>
<p>以上方法分为两类.<br>第二类方法为:过滤查询字段(主键除外),入参不包含 class 的调用前需要<code>wrapper</code>内的<code>entity</code>属性有值! 这两类方法重复调用以最后一次为准</p>
</blockquote>
<ul>
<li>例: <code>select(&quot;id&quot;, &quot;name&quot;, &quot;age&quot;)</code></li>
<li>例: <code>select(i -&gt; i.getProperty().startsWith(&quot;test&quot;))</code></li>
</ul>
<h3 id="UpdateWrapper"><a href="#UpdateWrapper" class="headerlink" title="UpdateWrapper"></a>UpdateWrapper</h3><blockquote>
<p>说明：</p>
<p>继承自 <code>AbstractWrapper</code> ,自身的内部属性 <code>entity</code> 也用于生成 where 条件及 <code>LambdaUpdateWrapper</code>, 可以通过 <code>new UpdateWrapper().lambda()</code> 方法获取</p>
</blockquote>
<h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set(String column, Object val)</span><br><span class="line">set(<span class="type">boolean</span> condition, String column, Object val)</span><br></pre></td></tr></table></figure>

<ul>
<li>SQL SET 字段</li>
<li>例: <code>set(&quot;name&quot;, &quot;老李头&quot;)</code></li>
<li>例: <code>set(&quot;name&quot;, &quot;&quot;)</code>—&gt;数据库字段值变为<strong>空字符串</strong></li>
<li>例: <code>set(&quot;name&quot;, null)</code>—&gt;数据库字段值变为<code>null</code></li>
</ul>
<h4 id="setSql"><a href="#setSql" class="headerlink" title="setSql"></a>setSql</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setSql(String sql)</span><br></pre></td></tr></table></figure>

<ul>
<li>设置 SET 部分 SQL</li>
<li>例: <code>setSql(&quot;name = &#39;老李头&#39;&quot;)</code></li>
</ul>
<h4 id="lambda"><a href="#lambda" class="headerlink" title="lambda"></a>lambda</h4><ul>
<li>获取 <code>LambdaWrapper</code><br>在<code>QueryWrapper</code>中是获取<code>LambdaQueryWrapper</code><br>在<code>UpdateWrapper</code>中是获取<code>LambdaUpdateWrapper</code></li>
</ul>
<h3 id="使用Wrapper自定义SQL"><a href="#使用Wrapper自定义SQL" class="headerlink" title="使用Wrapper自定义SQL"></a>使用Wrapper自定义SQL</h3><blockquote>
<p>需求来源:</p>
<p>在使用了<code>mybatis-plus</code>之后, 自定义SQL的同时也想使用<code>Wrapper</code>的便利应该怎么办？ 在<code>mybatis-plus</code>版本<code>3.0.7</code>得到了完美解决 版本需要大于或等于<code>3.0.7</code>, 以下两种方案取其一即可</p>
</blockquote>
<h4 id="Service-java"><a href="#Service-java" class="headerlink" title="Service.java"></a>Service.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlMapper.getAll(Wrappers.&lt;MysqlData&gt;lambdaQuery().eq(MysqlData::getGroup, <span class="number">1</span>));</span><br></pre></td></tr></table></figure>

<h4 id="方案一-注解方式-Mapper-java"><a href="#方案一-注解方式-Mapper-java" class="headerlink" title="方案一 注解方式 Mapper.java"></a>方案一 注解方式 Mapper.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from mysql_data $&#123;ew.customSqlSegment&#125;&quot;)</span></span><br><span class="line">List&lt;MysqlData&gt; <span class="title function_">getAll</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper wrapper)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="方案二-XML形式-Mapper-xml"><a href="#方案二-XML形式-Mapper-xml" class="headerlink" title="方案二 XML形式 Mapper.xml"></a>方案二 XML形式 Mapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;MysqlData&quot;</span>&gt;</span></span><br><span class="line">	SELECT * FROM mysql_data $&#123;ew.customSqlSegment&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="kotlin使用wrapper"><a href="#kotlin使用wrapper" class="headerlink" title="kotlin使用wrapper"></a>kotlin使用wrapper</h4><blockquote>
<p>kotlin 可以使用 <code>QueryWrapper</code> 和 <code>UpdateWrapper</code> 但无法使用 <code>LambdaQueryWrapper</code> 和 <code>LambdaUpdateWrapper</code><br>如果想使用 lambda 方式的 wrapper 请使用 <code>KtQueryWrapper</code> 和 <code>KtUpdateWrapper</code></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/12/java/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QB">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="genuine nonage">
      <meta itemprop="description" content="菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | genuine nonage">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/12/java/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-12 17:42:50" itemprop="dateCreated datePublished" datetime="2020-11-12T17:42:50+08:00">2020-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="阿里巴巴Java开发手册"><a href="#阿里巴巴Java开发手册" class="headerlink" title="阿里巴巴Java开发手册"></a>阿里巴巴Java开发手册</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>划分七个维度：编程规约、异常日志、单元测试、安全规约、MySQL数据库、工程结构、设计规约。</p>
<h2 id="编程规约"><a href="#编程规约" class="headerlink" title="编程规约"></a>编程规约</h2><h3 id="命名风格"><a href="#命名风格" class="headerlink" title="命名风格"></a>命名风格</h3><ol>
<li>代码中的命名不能以下划线或美元符号开始或结束。</li>
<li>代码中的命名严禁使用拼音与英文混合的方式，更不允许直接使用中文。</li>
<li>类名是使用UpperCamelCase风格，但有例外：DO/BO/DTO/VO/AO/PO/UID等。<ol>
<li>正例：UserDO/XmlService</li>
<li>反例：UserDo/XMLService</li>
</ol>
</li>
<li>方法名、参数名、成员变量、局部变量统一使用lowerCamelCase风格。必须遵从驼峰式。</li>
<li>常量名全部大写，单词间用下划线隔开，力求语义表达完整，不要嫌名字长。</li>
<li>抽象类命名使用Abstract或Base开头；异常类命名使用Exception结尾；测试类命名以Test结尾。</li>
<li>类型与中括号紧挨相连表示数组。</li>
<li>POJO类中布尔类型变量都不要加si前缀，否则部分框架解析会引起序列化错误。</li>
<li>包名统一使用小写，点分隔符之间有且仅有一个自然语义的英语单词。</li>
<li>避免在子父类的成员变量之间、或者不同代码块的局部变量之间采用完全相同的命名。</li>
<li>杜绝不规范缩写。</li>
<li>任何自定义编程元素在命名时，使用尽量完整的单词组合来表达其意。</li>
<li>命名常量与变量时，表示类型的名词放在词尾。<ol>
<li>正例：startTime</li>
</ol>
</li>
<li>如果模块、接口、类、方法使用了设计模式，在命名时体现出具体模式<ol>
<li>public class OrderFactory;</li>
</ol>
</li>
<li>接口类中的方法和属性不要加任何修饰符号（public也不要加），保持代码的简洁性，并加上有效的Javadoc注释。尽量不要在接口里定义变量，除非与接口方法相关，并且是整个应用的基础常量。</li>
<li>接口和实现类有两套命名规则<ol>
<li>对于Service和DAO类，基于SOA理念，暴露出来的服务一定是接口，额你不的实现类用Impl的后缀与接口区别。</li>
<li>如果是形容能力的接口名称，去对应的形容词为接口名（通常是-able的形容词）<ol>
<li>正例：AbstractTranslator实现Translatable接口。</li>
</ol>
</li>
</ol>
</li>
<li>枚举类名带上Enum后缀，枚举成员名称需全大写，单词间用下划线隔开。<ol>
<li>说明：枚举其实就是特殊的类，域成员均为常量，且构造方法被默认强制是私有。</li>
</ol>
</li>
<li>各层命名规约：<ol>
<li>Service/DAO层方法命名规约<ol>
<li>获取单个对象的方法用 get 做前缀。</li>
<li>获取多个对象的方法用 list 做前缀，复数形式结尾如：listObjects。</li>
<li> 获取统计值的方法用 count 做前缀。 </li>
<li>插入的方法用 save/insert 做前缀。</li>
<li>删除的方法用 remove/delete 做前缀。</li>
<li>修改的方法用 update 做前缀。</li>
</ol>
</li>
<li>领域模型命名规约<ol>
<li>数据对象：xxxDO，xxx 即为数据表名。</li>
<li>数据传输对象：xxxDTO，xxx 为业务领域相关的名称。</li>
<li>展示对象：xxxVO，xxx 一般为网页名称。</li>
<li>POJO 是 DO/DTO/BO/VO 的统称，禁止命名成 xxxPOJO。</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="代码格式"><a href="#代码格式" class="headerlink" title="代码格式"></a>代码格式</h3><h3 id="OOP规约"><a href="#OOP规约" class="headerlink" title="OOP规约"></a>OOP规约</h3><h3 id="集合处理"><a href="#集合处理" class="headerlink" title="集合处理"></a>集合处理</h3><h3 id="并发处理"><a href="#并发处理" class="headerlink" title="并发处理"></a>并发处理</h3><ol>
<li>获取单例对象需要保证线程安全，其中的方法也要保证线程安全。</li>
<li>创建线程或线程池是请指定有意义的线程名称，方便出错时回溯。</li>
<li>线程资源必须通过线程池提供，不允许在应用中自行显式创建线程。</li>
<li>线程池不允许使用Executors去创建，通过ThreadPoolExector的方式。可以更加明确线程池的运行规则，规避资源耗尽的风险。</li>
<li>SimpleDateFormat 是线程不安全的类，一般不要定义为 static 变量，如果定义为static，必须加锁，或者使用 DateUtils 工具类。</li>
<li>必须回收自定义的ThreadLocal变量，尤其在线程池场景下，线程经常会被复用，如不清理，可能会影响后续业务逻辑和造成内存泄漏等问题。尽量在代理中使用try-finally块进行回收。</li>
<li>高并发时，同步调用应该去考量锁的性能损耗。能用无锁数据结构，就不要用锁；能锁区块，不要锁整个方法体；能用对象锁，不要用类锁。<ol>
<li>说明：尽可能使加锁的代码块工作量尽可能的小，避免在锁代码块中调用RPC方法。</li>
</ol>
</li>
<li>对多个资源、数据库表、对象同时加锁时，需要保持一致的加锁顺序，否则可能会造成死锁。</li>
<li>在使用阻塞等待获取锁的方式中，必须在 try 代码块之外，并且在加锁方法与 try 代码块之间没有任何可能抛出异常的方法调用，避免加锁成功后，在 finally 中无法解锁。</li>
<li>在使用尝试机制来获取锁的方式中，进入业务代码块之前，必须先判断当前线程是否持有锁。锁的释放规则与锁的阻塞等待方式相同。<ol>
<li>说明：Lock 对象的 unlock 方法在执行时，它会调用 AQS 的 tryRelease 方法（取决于具体实现类），如果当前线程不持有锁，则抛出IllegalMonitorStateException 异常。</li>
</ol>
</li>
<li>并发修改同一记录时，避免更新丢失，需要加锁。要么在应用层加锁，要么在缓存加锁，要么在数据库层使用乐观锁，使用 version 作为更新依据。<ol>
<li>说明：如果每次访问冲突概率小于 20%，推荐使用乐观锁，否则使用悲观锁。乐观锁的重试次数不得小于3次。</li>
</ol>
</li>
<li>多线程并行处理定时任务时，Timer 运行多个 TimeTask 时，只要其中之一没有捕获抛出的异常，其它任务便会自动终止运行，如果在处理定时任务时使用ScheduledExecutorService 则没有这个问题。</li>
<li>资金相关的金融敏感信息，使用悲观锁策略。<ol>
<li>说明：乐观锁在获得锁的同时已经完成了更新操作，校验逻辑容易出现漏洞，乐观锁对冲突的解决策略有较复杂的要求，处理不当容易造成系统压力或数据异常。</li>
</ol>
</li>
<li>使用CountDownLatch进行异步转同步操作，每个线程退出前必须调用countDown方法，线程执行代码注意catch异常，确保countDown方法被执行到，避免主线程无法执行至await方法，知道超出时才返回结果。<ol>
<li>说明：注意，子线程抛出异常堆栈，不能在主线程try-catch到。</li>
</ol>
</li>
<li>避免 Random 实例被多线程使用，虽然共享该实例是线程安全的，但会因竞争同一seed 导致的性能下降。</li>
<li>在并发场景下，通过双重检查锁实现延迟初始化的优化问题隐患，推荐解决方案中较为简单一种（适用于 JDK5 及以上版本），将目标属性声明为 volatile 型。</li>
<li>volatile 解决多线程内存不可见问题。对于一写多读，是可以解决变量同步问题，但是如果多写，同样无法解决线程安全问题。</li>
<li>HashMap 在容量不够进行 resize 时由于高并发可能出现死链，导致 CPU 飙升，在开发过程中可以使用其它数据结构或加锁来规避此风险。</li>
<li>ThreadLocal 对象使用 static 修饰，ThreadLocal 无法解决共享对象的更新问题。</li>
</ol>
<h3 id="控制语句"><a href="#控制语句" class="headerlink" title="控制语句"></a>控制语句</h3><ol>
<li>在一个switch块内，每个case要么通过continue/break/return等来终止，要么注释说明程序将继续执行到哪一个case为止；在一个switch块内，必须包含一个default语句并且放在最后，即使什么代码也没有。</li>
<li>当 switch 括号内的变量类型为 String 并且此变量为外部参数时，必须先进行 null判断。</li>
<li>在 if/else/for/while/do 语句中必须使用大括号。</li>
<li>在高并发场景中，避免使用”等于”判断作为中断或退出的条件。</li>
<li>表达异常的分支时，少用 if-else 方式。</li>
</ol>
<h3 id="注释规约"><a href="#注释规约" class="headerlink" title="注释规约"></a>注释规约</h3><ol>
<li>类、类属性、类方法的注释必须使用Javadoc规范，使用/** 内容 */格式，不得使用// xxx 方式。<ol>
<li>说明：在IDE编辑窗口中，Javadoc方式会提示相关注释。提高阅读效率。</li>
</ol>
</li>
<li>所有的抽象方法（包括接口中的方法）必须要用 Javadoc 注释，除了返回值、参数、异常说明外，还必须指出该方法做什么事情，实现什么功能。<ol>
<li>说明：对子类的实现要求，或者调用注意事项，请一并说明。</li>
</ol>
</li>
<li>所有的类都必须添加创建者和创建日期。</li>
<li>方法内部单行注释，在被注释语句上方另起一行，使用//注释。方法内部多行注释使用/* */注释，注意与代码对齐。</li>
<li>所有的枚举类型字段必须要有注释，说明每个数据项的用途。</li>
<li>与其“半吊子”英文来注释，不如用中文注释把问题说清楚。专有名词与关键字保持英文原文即可。</li>
<li>代码修改的同时，注释也要进行相应的修改，尤其是参数、返回值、异常、核心逻辑等的修改。</li>
<li>谨慎注释掉代码。在上方详细说明，而不是简单地注释掉。如果无用，则删除。</li>
<li>对于注释的要求：第一、能够准确反映设计思想和代码逻辑；第二、能够描述业务含义，使别的程序员能够迅速了解到代码背后的信息。</li>
<li>好的命名、代码结构是自解释的，注释力求精简准确、表达到位。避免出现注释的一个极端：过多过滥的注释，代码的逻辑一旦修改，修改注释是相当大的负担。</li>
<li>特殊注释标记，请注明标记人与标记时间。注意及时处理这些标记，通过标记扫描，经常清理此类标记。线上故障有时候就是来源于这些标记处的代码。<ol>
<li>待办事宜（TODO）:（标记人，标记时间，[预计处理时间]）</li>
<li>错误，不能工作（FIXME）:（标记人，标记时间，[预计处理时间]）</li>
</ol>
</li>
<li>对于暂时被注释掉，后续可能恢复使用的代码片断，在注释代码上方，统一规定使用三个斜杠(///)来说明注释掉代码的理由。</li>
</ol>
<h2 id="异常日志"><a href="#异常日志" class="headerlink" title="异常日志"></a>异常日志</h2><h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><ol>
<li>Java 类库中定义的可以通过预检查方式规避的 RuntimeException 异常不应该通过 catch 的方式来处理，比如：NullPointerException，IndexOutOfBoundsException 等等。</li>
<li>异常不要用来做流程控制，条件控制。<ol>
<li>说明：异常设计的初衷是解决程序运行中的各种意外情况，且异常的处理效率比条件判断方式要低很多。</li>
</ol>
</li>
<li>catch 时请分清稳定代码和非稳定代码，稳定代码指的是无论如何不会出错的代码。对于非稳定代码的 catch 尽可能进行区分异常类型，再做对应的异常处理。</li>
<li>捕获异常是为了处理它，不要捕获了却什么都不处理而抛弃之，如果不想处理它，请将该异常抛给它的调用者。最外层的业务使用者，必须处理异常，将其转化为用户可以理解的内容。</li>
<li>有 try 块放到了事务代码中，catch 异常后，如果需要回滚事务，一定要注意手动回滚事务。</li>
<li>finally 块必须对资源对象、流对象进行关闭，有异常也要做 try-catch。<ol>
<li>说明：如果 JDK7 及以上，可以使用 try-with-resources 方式。</li>
</ol>
</li>
<li>不要在 finally 块中使用 return。</li>
<li>捕获异常与抛异常，必须是完全匹配，或者捕获异常是抛异常的父类。</li>
<li>在调用 RPC、二方包、或动态生成类的相关方法时，捕捉异常必须使用 Throwable类来进行拦截。</li>
<li>方法的返回值可以为 null，不强制返回空集合，或者空对象等，必须添加注释充分说明什么情况下会返回 null 值。</li>
<li>防止 NPE，是程序员的基本修养，注意 NPE 产生的场景：<ol>
<li>返回类型为基本数据类型，return 包装数据类型的对象时，自动拆箱有可能产生 NPE。</li>
<li>数据库的查询结果可能为 null。 </li>
<li>集合里的元素即使 isNotEmpty，取出的数据元素也可能为 null。 </li>
<li>远程调用返回对象时，一律要求进行空指针判断，防止 NPE。 </li>
<li>对于 Session 中获取的数据，建议进行 NPE 检查，避免空指针。</li>
<li>级联调用 obj.getA().getB().getC()；一连串调用，易产生 NPE。</li>
</ol>
</li>
<li>定义时区分 unchecked / checked 异常，避免直接抛出 new RuntimeException()，更不允许抛出 Exception 或者 Throwable，应使用有业务含义的自定义异常。推荐业界已定义过的自定义异常，如：DAOException / ServiceException 等。</li>
<li>对于公司外的 http/api 开放接口必须使用“错误码”；而应用内部推荐异常抛出；跨应用间 RPC 调用优先考虑使用 Result 方式，封装 isSuccess()方法、“错误码”、“错误简短信息”。</li>
<li>避免出现重复的代码（Don’t Repeat Yourself），即 DRY 原则。</li>
</ol>
<h3 id="日志规约"><a href="#日志规约" class="headerlink" title="日志规约"></a>日志规约</h3><ol>
<li>应用中不可直接使用日志系统（Log4j、Logback）中的 API，而应依赖使用日志框架SLF4J 中的 API，使用门面模式的日志框架，有利于维护和各个类的日志处理方式统一。</li>
<li>所有日志文件至少保存 15 天，因为有些异常具备以“周”为频次发生的特点。网络运行状态、安全相关信息、系统监测、管理后台操作、用户敏感操作需要留存相关的网络日志不少于 6 个月。</li>
<li>应用中的扩展日志（如打点、临时监控、访问日志等）命名方式：appName_logType_logName.log。</li>
<li>在日志输出时，字符串变量之间的拼接使用占位符的方式。</li>
<li>对于 trace/debug/info 级别的日志输出，必须进行日志级别的开关判断。</li>
<li>避免重复打印日志，浪费磁盘空间，务必在 log4j.xml 中设置 additivity=false。</li>
<li>异常信息应该包括两类信息：案发现场信息和异常堆栈信息。如果不处理，那么通过关键字 throws 往上抛出。</li>
<li>谨慎地记录日志。生产环境禁止输出 debug 日志；有选择地输出 info 日志；如果使用 warn 来记录刚上线时的业务行为信息，一定要注意日志输出量的问题，避免把服务器磁盘撑爆，并记得及时删除这些观察日志。</li>
<li>可以使用 warn 日志级别来记录用户输入参数错误的情况</li>
<li>尽量用英文来描述日志错误信息，如果日志中的错误信息用英文描述不清楚的话使用中文描述即可，否则容易产生歧义。【强制】国际化团队或海外部署的服务器由于字符集问题，使用全英文来注释和描述日志错误信息。</li>
</ol>
<h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><ol>
<li>好的单元测试必须遵守 AIR 原则。好的单元测试宏观上来说，具有自动化、独立性、可重复执行的特点。</li>
<li>单元测试应该是全自动执行的，并且非交互式的。测试用例通常是被定期执行的，执行过程必须完全自动化才有意义。输出结果需要人工检查的测试不是一个好的单元测试。单元测试中不准使用 System.out 来进行人肉验证，必须使用 assert 来验证。</li>
<li>保持单元测试的独立性。为了保证单元测试稳定可靠且便于维护，单元测试用例之间决不能互相调用，也不能依赖执行的先后次序。</li>
<li>单元测试是可以重复执行的，不能受到外界环境的影响。</li>
</ol>
<h2 id="安全规约"><a href="#安全规约" class="headerlink" title="安全规约"></a>安全规约</h2><ol>
<li>隶属于用户个人的页面或者功能必须进行权限控制校验。</li>
<li>用户敏感数据禁止直接展示，必须对展示数据进行脱敏。</li>
<li>用户输入的 SQL 参数严格使用参数绑定或者 METADATA 字段值限定，防止 SQL 注入，禁止字符串拼接 SQL 访问数据库。</li>
<li>用户请求传入的任何参数必须做有效性验证。</li>
<li>禁止向 HTML 页面输出未经安全过滤或未正确转义的用户数据。</li>
<li>表单、AJAX 提交必须执行 CSRF 安全验证。</li>
<li>在使用平台资源，譬如短信、邮件、电话、下单、支付，必须实现正确的防重放的 机制，如数量限制、疲劳度控制、验证码校验，避免被滥刷而导致资损。</li>
<li>发贴、评论、发送即时消息等用户生成内容的场景必须实现防刷、文本内容违禁词过滤等风控策略。</li>
</ol>
<h2 id="MySQL数据库"><a href="#MySQL数据库" class="headerlink" title="MySQL数据库"></a>MySQL数据库</h2><h2 id="建表规约"><a href="#建表规约" class="headerlink" title="建表规约"></a>建表规约</h2><ol>
<li><p>表达是与否概念的字段，必须使用 is_xxx 的方式命名，数据类型是 unsigned tinyint（1 表示是，0 表示否）。</p>
<ol>
<li>说明：任何字段如果为非负数，必须是 unsigned。</li>
<li>注意：POJO 类中的任何布尔类型的变量，都不要加 is 前缀，所以，需要在&lt; resultMap &gt;设置从 is_xxx到 Xxx 的映射关系。数据库表示是与否的值，使用 tinyint 类型，坚持 is_xxx 的命名方式是为了明确其取值含义与取值范围。</li>
</ol>
</li>
<li><p>表名、字段名必须使用小写字母或数字，禁止出现数字开头，禁止两个下划线中间只出现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑。</p>
<ol>
<li>说明：MySQL 在 Windows 下不区分大小写，但在 Linux 下默认是区分大小写。因此，数据库名、表名、字段名，都不允许出现任何大写字母，避免节外生枝。</li>
</ol>
</li>
<li><p>表名不使用复数名词。</p>
</li>
<li><p>禁用保留字，如 desc、range、match、delayed 等，请参考 MySQL 官方保留字。</p>
</li>
<li><p>主键索引名为 pk_字段名；唯一索引名为 uk_字段名；普通索引名则为 idx_字段名。</p>
<ol>
<li>说明：pk_ 即 primary key；uk_ 即 unique key；idx_ 即 index 的简称。</li>
</ol>
</li>
<li><p>小数类型为 decimal，禁止使用 float 和 double。</p>
<ol>
<li>说明：在存储的时候，float 和 double 都存在精度损失的问题，很可能在比较值的时候，得到不正确的结果。如果存储的数据范围超过 decimal 的范围，建议将数据拆成整数和小数并分开存储。</li>
</ol>
</li>
<li><p>如果存储的字符串长度几乎相等，使用 char 定长字符串类型。</p>
</li>
<li><p>varchar 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索引效率。</p>
</li>
<li><p>表必备三字段：id, create_time, update_time。</p>
<ol>
<li>说明：：其中 id 必为主键，类型为 bigint unsigned、单表时自增、步长为 1。create_time, update_time的类型均为 datetime 类型。</li>
</ol>
</li>
<li><p>表的命名最好是遵循“业务名称_表的作用”</p>
<ol>
<li>正例：alipay_task / force_project / trade_config</li>
</ol>
</li>
<li><p>库名与应用名称尽量一致。</p>
</li>
<li><p>如果修改字段含义或对字段表示的状态追加时，需要及时更新字段注释。</p>
</li>
<li><p>字段允许适当冗余，以提高查询性能，但必须考虑数据一致。冗余字段应遵循：</p>
<ol>
<li>不是频繁修改的字段。</li>
<li>不是 varchar 超长字段，更不能是 text 字段。</li>
<li>不是唯一索引的字段。</li>
</ol>
</li>
<li><p>单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。</p>
<ol>
<li>说明：如果预计三年后的数据量根本达不到这个级别，请不要在创建表时就分库分表。</li>
</ol>
</li>
<li><p>合适的字符存储长度，不但节约数据库表空间、节约索引存储，更重要的是提升检</p>
<p>索速度。</p>
</li>
</ol>
<h2 id="索引规约"><a href="#索引规约" class="headerlink" title="索引规约"></a>索引规约</h2><ol>
<li>业务上具有唯一特性的字段，即使是多个字段的组合，也必须建成唯一索引。</li>
<li>超过三个表禁止 join。需要 join 的字段，数据类型必须绝对一致；多表关联查询时，保证被关联的字段需要有索引。</li>
<li>在 varchar 字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度即可。</li>
<li>页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。</li>
<li>如果有 order by 的场景，请注意利用索引的有序性。order by 最后的字段是组合索引的一部分，并且放在索引组合顺序的最后，避免出现 file_sort 的情况，影响查询性能。<ol>
<li>正例：where a=? and b=? order by c; 索引：a_b_c 。</li>
</ol>
</li>
<li>利用覆盖索引来进行查询操作，避免回表。<ol>
<li>说明：如果一本书需要知道第 11 章是什么标题，会翻开第 11 章对应的那一页吗？目录浏览一下就好，这个目录就是起到覆盖索引的作用。</li>
</ol>
</li>
<li>利用延迟关联或者子查询优化超多分页场景。<ol>
<li>说明：：MySQL 并不是跳过 offset 行，而是取 offset+N 行，然后返回放弃前 offset 行，返回 N 行，那当offset 特别大的时候，效率就非常的低下，要么控制返回的总页数，要么对超过特定阈值的页数进行 SQL改写。</li>
</ol>
</li>
<li>SQL 性能优化的目标：至少要达到 range 级别，要求是 ref 级别，如果可以是consts 最好。<ol>
<li>consts 单表中最多只有一个匹配行（主键或者唯一索引），在优化阶段即可读取到数据。</li>
<li>ref 指的是使用普通的索引（normal index）。 </li>
<li>range 对索引进行范围检索。</li>
</ol>
</li>
<li>建组合索引的时候，区分度最高的在最左边。<ol>
<li>如果 where a=? and b=? ，如果 a 列的几乎接近于唯一值，那么只需要单建 idx_a 索引即可。</li>
<li>说明：存在非等号和等号混合时，在建索引时，请把等号条件的列前置。如：where c&gt;? and d=? 那么即使 c 的区分度更高，也必须把 d 放在索引的最前列，即索引 idx_d_c。</li>
</ol>
</li>
<li>防止因字段类型不同造成的隐式转换，导致索引失效。</li>
<li>创建索引时避免有如下极端误解：<ol>
<li>宁滥勿缺。认为一个查询就需要建一个索引。</li>
<li>宁缺勿滥。认为索引会消耗空间、严重拖慢记录的更新以及行的新增速度。</li>
<li>抵制惟一索引。认为业务的惟一性一律需要在应用层通过“先查后插”方式解决。</li>
</ol>
</li>
</ol>
<h2 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h2><ol>
<li>不要使用 count(列名)或 count(常量)来替代 count(<em>)，count(</em>)是 SQL92 定义的标准统计行数的语法，跟数据库无关，跟 NULL 和非 NULL 无关。<ol>
<li>说明：count(*)会统计值为 NULL 的行，而 count(列名)不会统计此列为 NULL 值的行。</li>
</ol>
</li>
<li>count(distinct col) 计算该列除 NULL 之外的不重复行数，注意 count(distinct col1, col2) 如果其中一列全为 NULL，那么即使另一列有不同的值，也返回为 0。</li>
<li>当某一列的值全是 NULL 时，count(col)的返回结果为 0，但 sum(col)的返回结果为 NULL，因此使用 sum()时需注意 NPE 问题。<ol>
<li>正例：使用如下方式来避免 sum 的 NPE 问题：SELECT IFNULL(SUM(column), 0) FROM table;</li>
</ol>
</li>
<li>使用 ISNULL()来判断是否为 NULL 值。<ol>
<li>说明：NULL 与任何值的直接比较都为 NULL。 </li>
</ol>
</li>
<li>代码中写分页查询逻辑时，若 count 为 0 应直接返回，避免执行后面的分页语句。</li>
<li>不得使用外键与级联，一切外键概念必须在应用层解决。<ol>
<li>说明：以学生和成绩的关系为例，学生表中的 student_id 是主键，那么成绩表中的 student_id 则为外键。如果更新学生表中的 student_id，同时触发成绩表中的 student_id 更新，即为级联更新。外键与级联更新适用于单机低并发，不适合分布式、高并发集群；级联更新是强阻塞，存在数据库更新风暴的风险；外键影响数据库的插入速度。</li>
</ol>
</li>
<li>禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。</li>
<li>数据订正（特别是删除、修改记录操作）时，要先 select，避免出现误删除，确认无误才能执行更新语句。</li>
<li>in 操作能避免则避免，若实在避免不了，需要仔细评估 in 后边的集合元素数量，控制在 1000 个之内。</li>
<li>如果有国际化需要，所有的字符存储与表示，均以 utf-8 编码，注意字符统计函数的区别。<ol>
<li>说明：如果需要存储表情，那么选择 utf8mb4 来进行存储，注意它与 utf-8 编码的区别。</li>
</ol>
</li>
<li>TRUNCATE TABLE 比 DELETE 速度快，且使用的系统和事务日志资源少，但TRUNCATE 无事务且不触发 trigger，有可能造成事故，故不建议在开发代码中使用此语句。</li>
</ol>
<h3 id="ORM映射"><a href="#ORM映射" class="headerlink" title="ORM映射"></a>ORM映射</h3><ol>
<li>在表查询中，一律不要使用 * 作为查询的字段列表，需要哪些字段必须明确写明。<ol>
<li>增加查询分析器解析成本。</li>
<li>增加查询分析器解析成本。</li>
<li>无用字段增加网络消耗，尤其是 text 类型的字段。</li>
</ol>
</li>
<li>POJO 类的布尔属性不能加 is，而数据库字段必须加 is_，要求在 resultMap 中进行字段与属性之间的映射。</li>
<li>不要用 resultClass 当返回参数，即使所有类属性名与数据库字段一一对应，也需要定义；反过来，每一个表也必然有一个 POJO 类与之对应。</li>
<li>sql.xml 配置参数使用：#{}，#param# 不要使用${} 此种方式容易出现 SQL 注入。</li>
<li>iBATIS 自带的 queryForList(String statementName,int start,int size)不推荐使用。<ol>
<li>其实现方式是在数据库取到 statementName 对应的 SQL 语句的所有记录，再通过 subList 取start,size 的子集合。</li>
</ol>
</li>
<li>不允许直接拿 HashMap 与 Hashtable 作为查询结果集的输出。</li>
<li>更新数据表记录时，必须同时更新记录对应的 gmt_modified 字段值为当前时间。</li>
<li>不要写一个大而全的数据更新接口。传入为 POJO 类，不管是不是自己的目标更新字段，都进行 update table set c1=value1,c2=value2,c3=value3; 这是不对的。执行 SQL时，不要更新无改动的字段，一是易出错；二是效率低；三是增加 binlog 存储。</li>
<li>@Transactional 事务不要滥用。事务会影响数据库的 QPS，另外使用事务的地方需要考虑各方面的回滚方案，包括缓存回滚、搜索引擎回滚、消息补偿、统计修正等。</li>
<li>&lt; isEqual &gt;中的 compareValue 是与属性值对比的常量，一般是数字，表示相等时带上此条件；&lt; isNotEmpty &gt;表示不为空且不为 null 时执行；&lt; isNotNull &gt;表示不为 null 值时执行。 </li>
</ol>
<h2 id="工程结构"><a href="#工程结构" class="headerlink" title="工程结构"></a>工程结构</h2><h3 id="应用分层"><a href="#应用分层" class="headerlink" title="应用分层"></a>应用分层</h3><h3 id="二方库依赖"><a href="#二方库依赖" class="headerlink" title="二方库依赖"></a>二方库依赖</h3><h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><h2 id="设计规约"><a href="#设计规约" class="headerlink" title="设计规约"></a>设计规约</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/11/%E5%BA%9F%E5%BC%83/%E3%80%8AJava%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QB">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="genuine nonage">
      <meta itemprop="description" content="菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | genuine nonage">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/11/%E5%BA%9F%E5%BC%83/%E3%80%8AJava%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">《Java编程思想》已放弃转为别的书籍</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-11 15:27:00" itemprop="dateCreated datePublished" datetime="2020-11-11T15:27:00+08:00">2020-11-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-02-08 15:25:40" itemprop="dateModified" datetime="2021-02-08T15:25:40+08:00">2021-02-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="第1章-对象导论"><a href="#第1章-对象导论" class="headerlink" title="第1章 对象导论"></a>第1章 对象导论</h1><p>面向对象编程（Object-Oriented Programming OOP）是一种编程思维方式和编码架构。</p>
<p>Java面向对象语言的五个基本特性：</p>
<ol>
<li>万物皆为对象。</li>
<li>程序是对象的集合，它们通过发送消息来告诉彼此所要做的。</li>
<li>每个对象都有自己的有其他对象所构成的存储。</li>
<li>每个对象都拥有其类型。</li>
<li>某一特定类型的所有对象都可以接收同样的消息。</li>
</ol>
<h1 id="第5章-初始化于清理"><a href="#第5章-初始化于清理" class="headerlink" title="第5章 初始化于清理"></a>第5章 初始化于清理</h1><h2 id="5-5-清理：终结处理和垃圾回收"><a href="#5-5-清理：终结处理和垃圾回收" class="headerlink" title="5.5 清理：终结处理和垃圾回收"></a>5.5 清理：终结处理和垃圾回收</h2><p>finalize()垃圾回收不等于“析构”。</p>
<h1 id="第9章-接口"><a href="#第9章-接口" class="headerlink" title="第9章 接口"></a>第9章 接口</h1><p>看不懂 9.3 完全解耦</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/10/%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QB">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="genuine nonage">
      <meta itemprop="description" content="菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | genuine nonage">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/10/%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-10 00:00:00" itemprop="dateCreated datePublished" datetime="2020-11-10T00:00:00+08:00">2020-11-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-06-25 14:24:02" itemprop="dateModified" datetime="2021-06-25T14:24:02+08:00">2021-06-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="1-一方库、二方库、三方库是什么？"><a href="#1-一方库、二方库、三方库是什么？" class="headerlink" title="1. 一方库、二方库、三方库是什么？"></a>1. 一方库、二方库、三方库是什么？</h3><p>一方库：本工程中的各模块的相互依赖。</p>
<p>二方库：公司内部的依赖库，一般指公司内部的其他项目发布的jar包</p>
<p>三方库：公司之外的开源库，比如apache、ibm、google等发布的依赖</p>
<h3 id="2-Java中-方法签名是什么？"><a href="#2-Java中-方法签名是什么？" class="headerlink" title="2. Java中 方法签名是什么？"></a>2. Java中 方法签名是什么？</h3><p>方法声明的两个组件构成了方法签名：方法的名称和参数类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculateAnswer</span><span class="params">(<span class="type">double</span> wingSpan, <span class="type">int</span> numberOfEngines,</span></span><br><span class="line"><span class="params">                              <span class="type">double</span> length, <span class="type">double</span> grossTons)</span> &#123;</span><br><span class="line">    <span class="comment">//do the calculation here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面方法的签名是:<br><code>calculateAnswer(double, int, double, double)</code></p>
<h3 id="3-OOM"><a href="#3-OOM" class="headerlink" title="3. OOM"></a>3. OOM</h3><h4 id="什么是OOM？"><a href="#什么是OOM？" class="headerlink" title="什么是OOM？"></a>什么是OOM？</h4><p>OOM，全称”Out Of Memory”—“内存用完了”，来源于java.lang.OutOfMemoryError。</p>
<p>当JVM因为没有足够的内存来为对象分配空间并且垃圾回收器也没有空间可回收时，就会抛出这个error。</p>
<h4 id="为什么会OOM？"><a href="#为什么会OOM？" class="headerlink" title="为什么会OOM？"></a>为什么会OOM？</h4><ol>
<li>分配的少了：虚拟机本身可使用的内存（一般通过启动时的VM参数指定）太少。</li>
<li>应用用的太多，并且用完没释放，浪费了。此时造成内存泄露或者内存溢出。</li>
</ol>
<h4 id="内存泄漏，内存溢出"><a href="#内存泄漏，内存溢出" class="headerlink" title="内存泄漏，内存溢出"></a>内存泄漏，内存溢出</h4><p><strong>内存泄漏</strong>：申请使用完的内存没有释放，导致虚拟机不能再次使用该内存，此时这段内存就泄露了。因为申请者不用了，而又不能被虚拟机分配给别人用。</p>
<p><strong>内存溢出</strong>：申请的内存超出了JVM能提供的内存大小，此时称之为溢出。</p>
<p><strong>在Java语言中</strong>，由于存在了垃圾自动回收机制，所以，我们一般不用去主动释放不用的对象所占的内存，也就是理论上来说，是<strong>不会存在“内存泄露”的</strong>。</p>
<p><strong>如果编码不当</strong>，比如，将某个对象的引用放到了全局的Map中，虽然方法结束了，但是由于垃圾回收器会根据对象的引用情况来回收内存，导致该对象不能被及时的回收。如果该种情况出现次数多了，就<strong>会导致内存溢出</strong>，比如<strong>系统中经常使用的缓存机制。</strong></p>
<h3 id="4-内部接口的作用？"><a href="#4-内部接口的作用？" class="headerlink" title="4. 内部接口的作用？"></a>4. 内部接口的作用？</h3><p>也被称为嵌套接口，在另一个接口内声明一个接口。</p>
<ol>
<li>逻辑分组仅在一个地方使用的接口的一种方式。</li>
<li>增加了封装。</li>
<li>更易读和可维护的代码。</li>
</ol>
<h3 id="5-缓存（cache）与缓冲区（buffer）的主要区别"><a href="#5-缓存（cache）与缓冲区（buffer）的主要区别" class="headerlink" title="5. 缓存（cache）与缓冲区（buffer）的主要区别"></a>5. 缓存（cache）与缓冲区（buffer）的主要区别</h3><p>Buffer的核心作用是用来缓冲，缓和冲击。</p>
<p>Cache的核心作用是加快取用的速度。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/19/%E9%A1%B9%E7%9B%AE/%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QB">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="genuine nonage">
      <meta itemprop="description" content="菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | genuine nonage">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/10/19/%E9%A1%B9%E7%9B%AE/%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE1/" class="post-title-link" itemprop="url">商城项目（一）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-10-19 15:03:00" itemprop="dateCreated datePublished" datetime="2020-10-19T15:03:00+08:00">2020-10-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-04-23 09:57:21" itemprop="dateModified" datetime="2021-04-23T09:57:21+08:00">2021-04-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h1><p>暂时设计B2C，未来项目成熟后，转向C2C。</p>
<p>分布式基础部分</p>
<ol>
<li>分布式的基本概念<ul>
<li>微服务、注册中心、配置中心、feign远程调用、网关（统一配置跨域）</li>
</ul>
</li>
<li>基础开发<ul>
<li>Spring Boot 2.0 、Spring Cloud、Mybatis-Plus、Vue组件化、阿里云对象存储</li>
</ul>
</li>
<li>环境<ul>
<li>Linux、Docker、MySql、Redis、逆向工程&amp;人人开源</li>
</ul>
</li>
<li>开发规范<ul>
<li>数据校验JSR303、全局异常处理、全局统一返回、全局跨域处理</li>
<li>枚举状态、业务状态码、VO与TO与PO划分、逻辑删除</li>
<li>Lombok：@Data、@Slf4j</li>
</ul>
</li>
</ol>
<h2 id="项目技术特点："><a href="#项目技术特点：" class="headerlink" title="项目技术特点："></a>项目技术特点：</h2><p>前后端分离开发，开发基于vue的后台管理系统</p>
<p>SpringCloud全新的解决方案</p>
<p>应用监控、限流、网关、熔断降级等分布式方案，全方位涉及</p>
<p>分布式事务、分布式锁等分布式系统难题</p>
<p>高并发场景，线程池、异步编排等使用</p>
<p>压力测试，性能优化</p>
<p>各种集群技术使用</p>
<p>CI/CD使用</p>
<h2 id="微服务架构"><a href="#微服务架构" class="headerlink" title="微服务架构"></a>微服务架构</h2><p>微服务：拒绝大型单体应用，基于业务边界进行服务强化拆分，服务独立部署运行。</p>
<h2 id="知识"><a href="#知识" class="headerlink" title="知识"></a>知识</h2><p>网络地址转换</p>
<h1 id="项目开始"><a href="#项目开始" class="headerlink" title="项目开始"></a>项目开始</h1><h2 id="1-安装服务器工具-docker-mysql-redis"><a href="#1-安装服务器工具-docker-mysql-redis" class="headerlink" title="1.安装服务器工具(docker,mysql,redis)"></a>1.安装服务器工具(docker,mysql,redis)</h2><ol>
<li><p>安装虚拟机</p>
<ol>
<li><p>安装VirtualBox</p>
</li>
<li><p>安装 vagrant 快速搭建虚拟机</p>
<ol>
<li><p>安装成功后重启系统。</p>
</li>
<li><p>cmd输入命令vagrant测试是否安装成功。</p>
</li>
<li><p>cmd输入vagrant init centos/7</p>
</li>
<li><p>cmd输入vagrant up 启动虚拟机（停止可以在VirtualBox中停止）</p>
</li>
<li><p>cmd输入vagrant ssh 链接上虚拟机</p>
<blockquote>
<p>vagrant reload   重启虚拟机</p>
</blockquote>
</li>
</ol>
</li>
</ol>
</li>
<li><p>安装docker</p>
<ol>
<li><p>卸载旧版本docke</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure></blockquote>
</li>
<li><p>下载</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install -y yum-utils</span><br><span class="line"></span><br><span class="line">$ sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></blockquote>
</li>
<li><p>安装</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure></blockquote>
</li>
<li><p>启动</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure></blockquote>
</li>
<li><p>检查当前虚拟机的镜像</p>
<blockquote>
<p>$ sudo docker images</p>
</blockquote>
</li>
<li><p>设置开机自启动</p>
<blockquote>
<p>$ sudo systemctl enable docker</p>
</blockquote>
</li>
<li><p>配置镜像加速</p>
<blockquote>
<p>在阿里云查找镜像加速器</p>
<p>sudo mkdir -p /etc/docker</p>
<p>sudo tee /etc/docker/daemon.json &lt;&lt;-‘EOF’ </p>
<p>{</p>
<p> “registry-mirrors”: [“<a href="https://x7tuoc0z.mirror.aliyuncs.com&quot;]">https://x7tuoc0z.mirror.aliyuncs.com&quot;]</a> </p>
<p>} </p>
<p>EOF</p>
<p>sudo systemctl daemon-reload </p>
<p>sudo systemctl restart docker</p>
</blockquote>
</li>
<li><p>其他的使用</p>
<blockquote>
<p>如果遇到docker镜像重启无法使用，就重启docker</p>
<p>systemctl restart docker</p>
<p>查看正在运行中的容器</p>
<p>docker ps</p>
<p>查看全部容器</p>
<p>docker ps -a</p>
<p>删除容器</p>
<p>docker rm -f 容器名</p>
<p>docker rmi 容器名</p>
<p>停止容器</p>
<p>docker stop 容器id</p>
<p>启动容器</p>
<p>docker start 容器id</p>
<p>删除镜像</p>
<p>docker rmi mysql:8.0</p>
<p>重启容器</p>
<p>docker restart 容器名</p>
<p>设置容器开机自启</p>
<p>docker update –restart=always 容器名</p>
</blockquote>
</li>
</ol>
</li>
<li><p>docker安装mysql</p>
<ol>
<li><p>mysql57</p>
<ol>
<li><p>下载MySQL57镜像</p>
<blockquote>
<p>docker pull mysql:5.7</p>
</blockquote>
</li>
<li><p>创建my.cnf文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /mydata/mysql57/conf/</span><br><span class="line">touch /mydata/mysql57/conf/my.cnf</span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">   [client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">   </span><br><span class="line">[mysql]</span><br><span class="line">   default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">   init_connect=&#x27;SET collation_connection=utf8_unicode_ci&#x27;</span><br><span class="line">   init_connect=&#x27;SET NAMES utf8&#x27;</span><br><span class="line">   character-set-server=utf8</span><br><span class="line">   collation-server=utf8_unicode_ci</span><br><span class="line">   skip-character-set-client-handshake</span><br><span class="line">   skip-name-resolve</span><br><span class="line">   max_connections=1500</span><br></pre></td></tr></table></figure></li>
<li><p>安装</p>
<blockquote>
<p>docker run -p 3306:3306 –name mysql57 <br>-v /mydata/mysql57/log:/var/log/mysql <br>-v /mydata/mysql57/data:/var/lib/mysql <br>-v /mydata/mysql57/conf:/etc/mysql <br>-e MYSQL_ROOT_PASSWORD=Aa19990804 <br>-d mysql:5.7</p>
</blockquote>
<blockquote>
<p>docker run -p 3306:3306 –name mysql57 -v $PWD/conf:/etc/mysql/conf.d -v $PWD/log:/logs -v $PWD/data:/mysql_data -e MYSQL_ROOT_PASSWORD=Aa19990804 -d mysql:5.7</p>
</blockquote>
<ol start="4">
<li><p>进入容器</p>
<blockquote>
<p>docker exec -it mysql57 /bin/bash</p>
</blockquote>
</li>
</ol>
</li>
<li><p>mysql8</p>
<ol>
<li><p>下载MySQL8.0镜像</p>
<blockquote>
<p>docker pull mysql:8.0</p>
</blockquote>
</li>
<li><p>创建my.cnf文件</p>
<blockquote>
<p>vi /mydata/mysql8/conf/my.cnf</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">      [mysqld]</span><br><span class="line">      pid-file        = /var/run/mysqld/mysqld.pid</span><br><span class="line">      socket          = /var/run/mysqld/mysqld.sock</span><br><span class="line">      datadir         = /var/lib/mysql</span><br><span class="line">      secure-file-priv= NULL</span><br><span class="line">      # Disabling symbolic-links is recommended to prevent assorted security risks</span><br><span class="line">      symbolic-links=0</span><br><span class="line"></span><br><span class="line">      # Custom config should go here</span><br><span class="line">!includedir /etc/mysql/conf.d/</span><br><span class="line">      </span><br><span class="line">      default_authentication_plugin= mysql_native_password</span><br></pre></td></tr></table></figure></li>
<li><p>安装</p>
<blockquote>
<p>docker run <br>-p 3307:3306 <br>-e MYSQL_ROOT_PASSWORD=root <br>-v /mydata/mysql8/data:/var/lib/mysql:rw <br>-v /mydata/mysql8/log:/var/log/mysql:rw <br>-v /mydata/mysql8/conf/my.cnf:/etc/mysql/my.cnf:rw <br>-v /etc/localtime:/etc/localtime:ro <br>–name mysql8 <br>–restart=always <br>-d mysql:8.0</p>
</blockquote>
</li>
<li><p>进入容器</p>
<blockquote>
<p>docker exec -it mysql8 /bin/bash</p>
</blockquote>
</li>
</ol>
</li>
</ol>
</li>
<li><p>docker安装redis</p>
<ol>
<li><p>下载镜像</p>
<blockquote>
<p>docker pull redis</p>
</blockquote>
</li>
<li><p>创建配置</p>
<blockquote>
<p>mkdir -p /mydata/redis/conf</p>
<p>touch /mydata/redis/conf/redis.conf </p>
</blockquote>
</li>
<li><p>运行容器</p>
<blockquote>
<p>docker run -p 6379:6379 –name redis -v /mydata/redis/data:/data -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf -d redis redis-server /etc/redis/redis.conf</p>
</blockquote>
</li>
<li><p>开启redis客户端</p>
<blockquote>
<p>docker exec -it redis redis-cli</p>
<p>redis默认是没有持久化的，数据存储在内存中。</p>
</blockquote>
</li>
<li><p>在Linux中编辑redis.conf文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br><span class="line">让redis启用aof的持久化方式</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h2 id="2-安装电脑工具"><a href="#2-安装电脑工具" class="headerlink" title="2. 安装电脑工具"></a>2. 安装电脑工具</h2><p>完成navicat，redisdesktopmanager，idea，vxcode，maven，git工具的安装与配置</p>
<h2 id="3-搭建脚手架"><a href="#3-搭建脚手架" class="headerlink" title="3. 搭建脚手架"></a>3. 搭建脚手架</h2><ol>
<li><p>在码云创建一个仓库java,maven。</p>
</li>
<li><p>在idea中新建Project from version control</p>
</li>
<li><p>创建项目微服务</p>
<ol>
<li>```txt<br>共同点：<ol>
<li>web，openfeign</li>
<li>每个服务，包名com.genuine.wmall.xxx(product/order/ware/coupon/member)</li>
<li>模块名：wmall-<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   2. 创建所有模块module，使用spring快速搭建，由于是**微服务**，必要的两个依赖web的**springweb**和**springcloudrouting的openfeign**</span><br><span class="line"></span><br><span class="line">4. 在wmall中创建并编辑pom.xml</span><br><span class="line"></span><br><span class="line">   关联各个微服务</span><br><span class="line"></span><br><span class="line">   ```xml</span><br><span class="line">   &lt;groupId&gt;com.genuine.wmall&lt;/groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;wmall&lt;/artifactId&gt;</span><br><span class="line">       &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">       &lt;name&gt;wmall&lt;/name&gt;</span><br><span class="line">       &lt;description&gt;聚合服务&lt;/description&gt;</span><br><span class="line">   	&lt;!-- 使用maven分模块管理 一般所有父级项目的packaging都为pom，packaging默认类型jar类型，如果不做配置，maven会将该项目打成jar包。 --&gt;</span><br><span class="line">       &lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line">       &lt;modules&gt;</span><br><span class="line">           &lt;module&gt;wmall-coupon&lt;/module&gt;</span><br><span class="line">           &lt;module&gt;wmall-member&lt;/module&gt;</span><br><span class="line">           &lt;module&gt;wmall-order&lt;/module&gt;</span><br><span class="line">           &lt;module&gt;wmall-product&lt;/module&gt;</span><br><span class="line">           &lt;module&gt;wmall-ware&lt;/module&gt;</span><br><span class="line">       &lt;/modules&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
</li>
<li><p>在maven中添加wmall模块（默认使root模块）。</p>
</li>
<li><p>在wmall中的.gitignore（git的模板，可以忽视垃圾文件）</p>
<p><strong>忽略设置：使git不上传远程仓库规定文件</strong></p>
<p>只将有用的代码纳入版本控制（Add VCS）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">**/  -- 代表任意目录</span><br><span class="line"></span><br><span class="line">**/mvnw</span><br><span class="line">**/mvnw.cmd</span><br><span class="line">**/.mvn</span><br><span class="line">**/target</span><br><span class="line">.idea</span><br><span class="line">**/.gitignore</span><br></pre></td></tr></table></figure></li>
<li><p>设计数据库</p>
<p>设计表，创建表。</p>
<p>在电商项目中表与表之间不做外键。</p>
<p>每一个服务创建自己的数据库。</p>
</li>
<li><p><strong>反向创建代码</strong></p>
<p>自动创建数据库实体类，dao层，service层</p>
<ol>
<li><p>构建数据库</p>
</li>
<li><p>下载人人开源的renren-fast和renren-fast-vue项目。</p>
</li>
<li><p>将两个项目的.git文件夹删掉</p>
</li>
<li><p>将renren-fast项目放入后台项目中，加入modules中，并创建数据库，之后可以运行测试。</p>
</li>
<li><p>使用vscode打开renren-fast-vue项目。</p>
<blockquote>
<p>npm install</p>
<p>npm run duv</p>
</blockquote>
</li>
<li><p>登录账户密码：admin   admin</p>
</li>
<li><p>下载并安装代码生成器renren-generator项目，放入wmall项目中，加入modules中，修改application.yml文件中的数据库配置。修改generator.properties文件中的配置</p>
<blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mainPath</span>=<span class="string">com.genuine</span></span><br><span class="line"><span class="attr">package</span>=<span class="string">com.genuine.wmall</span></span><br><span class="line"><span class="attr">moduleName</span>=<span class="string">product</span></span><br><span class="line"><span class="attr">author</span>=<span class="string">xuanhuanxingkong8</span></span><br><span class="line"><span class="attr">email</span>=<span class="string">xuanhuanxingkong8@gmail.com</span></span><br><span class="line"><span class="attr">tablePrefix</span>=<span class="string">pms</span></span><br></pre></td></tr></table></figure></blockquote>
</li>
<li><p>运行代码生成器服务</p>
</li>
<li><p>根据数据库的表，生成代码，导入到项目中。</p>
</li>
<li><p>修改程序中的报错的问题，将公共工具放到common模块中。</p>
</li>
<li><p><strong>整合MyBatis-Plus</strong></p>
<ol>
<li><p>导入依赖</p>
</li>
<li><p>配置</p>
<ol>
<li><p>配置数据源</p>
<ol>
<li><p>导入数据库驱动</p>
</li>
<li><p>配置数据源相关信息</p>
</li>
<li><p>配置MyBatis-Plus</p>
<pre><code>1. 使用@MapperScan
  
2. 告诉MyBatis-Plus，sql映射文件位置
  
   <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://81.70.204.157:3306/gulimall_pms</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"><span class="comment"># 表主键自增</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">  <span class="comment"># mapper-locations: classpath*:/mapper/**/*.xml</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br></pre></td></tr></table></figure>
  
   classpath后*表示任意模块路径下的mapper的任意路径下的任意.xml结尾的文件。
</code></pre>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="4-微服务"><a href="#4-微服务" class="headerlink" title="4. 微服务"></a>4. 微服务</h2><p>技术搭配方案：</p>
<p>Nacos：注册中心（服务发现/注册）</p>
<p>Nacos：配置中心（动态配置管理）</p>
<p>Ribbon：负载均衡</p>
<p>Feign：声明式HTTP客户端（调用远程服务）</p>
<p>Sentinel：服务容错（限流、降级、熔断）</p>
<p>Gateway：API网关（webflux编程模式）</p>
<p>Sleuth：调用链监控</p>
<p>Seata：原Fescar，分布式事务解决方案</p>
<h3 id="Nacos注册中心和OpenFeign远程调用"><a href="#Nacos注册中心和OpenFeign远程调用" class="headerlink" title="Nacos注册中心和OpenFeign远程调用"></a>Nacos注册中心和OpenFeign远程调用</h3><ol>
<li><p>分布式组件spring cloud alibaba</p>
<p>导入依赖：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>下载nacos服务器（注册中心、配置中心），并启动服务。</p>
<p><strong>在项目配置文件中配置Nacos Server地址和当前服务名</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        server-addr: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8848</span></span><br><span class="line">  application:</span><br><span class="line">    name: 项目名</span><br></pre></td></tr></table></figure>

<p><strong>使用@EnableDiscoveryClient注解开启服务注册与发现功能</strong></p>
<p>运行项目</p>
</li>
<li><p>Feign声明式远程调用</p>
<p>简介：Feign是一个声明式的HTTP客户端。整合了Ribbon（负载均衡）和Hystrix（服务熔断）。</p>
<p>步骤：</p>
<ol>
<li><p>引入open-feign</p>
</li>
<li><p>编写一个接口，需要调用远程服务</p>
<ol>
<li><p>声明接口的每一个方法都是调用那个远程服务的请求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被调用方 类中</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/member/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">membercoupons</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CouponEntity</span> <span class="variable">couponEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CouponEntity</span>();</span><br><span class="line">    couponEntity.setCouponName(<span class="string">&quot;满100减10&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;coupons&quot;</span>,Arrays.asList(couponEntity));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用远程服务的服务名</span></span><br><span class="line"><span class="meta">@FeignClient(&quot;wmall-coupon&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CouponFeignService</span> &#123;</span><br><span class="line">    <span class="comment">//使用接口的完整签名</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/coupon/coupon/member/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">membercoupons</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">调用方 类中</span><br><span class="line">   </span><br><span class="line">   ```java</span><br><span class="line">   //test调用方 类中</span><br><span class="line">   @Autowired</span><br><span class="line">   CouponFeignService couponFeignService;</span><br><span class="line">   </span><br><span class="line">   @RequestMapping(&quot;/coupons&quot;)</span><br><span class="line">public R test()&#123;</span><br><span class="line">       MemberEntity memberEntity = new MemberEntity();</span><br><span class="line">    memberEntity.setNickname(&quot;张三&quot;);</span><br><span class="line">       R membercoupons = couponFeignService.membercoupons();</span><br><span class="line">       return R.ok().put(&quot;member&quot;,memberEntity).put(&quot;coupons&quot;,membercoupons.get(&quot;coupons&quot;));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>调用方 启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启远程调用功能 自动扫描 全包名</span></span><br><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;com.genuine.wmall.member.feign&quot;)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WmallMemberApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(WmallMemberApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在浏览器发送请求：localhost:8000/member/member/coupons</p>
<p>附：如果服务停止，前端会显示，连接超时。</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="Nacos配置中心"><a href="#Nacos配置中心" class="headerlink" title="Nacos配置中心"></a>Nacos配置中心</h3><ol>
<li><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--使用配置中心做配置管理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>创建一个bootstrap.properties文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">wmall-coupon项目名</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br></pre></td></tr></table></figure></li>
<li><p>给配置中心默认添加一个 数据集（Data Id）。 默认规则：应用名.properties</p>
</li>
<li><p>给 应用名.properties 添加任何配置</p>
</li>
<li><p>动态获取配置。</p>
<ol>
<li><p>@RefreshScope 动态获取，并刷新配置。可应用在控制器类名上</p>
</li>
<li><p>@Value(${配置项名})  获取到配置</p>
<p>当配置中心和当前应用都配置了相同的项，优先使用配置中心的配置。</p>
</li>
</ol>
</li>
<li><p>细节：</p>
<ol>
<li><p>命名空间：配置隔离：</p>
<p>默认：public（保留空间）</p>
<p>基于不同环境隔离：开发，测试，生产：利用命名空间做环境隔离。</p>
<p>注意：在bootstrap.properties中配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.nacos.config.namespace</span>=<span class="string">bf179235-e27b-42e6-b162-8b598e0a2bae</span></span><br></pre></td></tr></table></figure>

<p><strong>基于微服务隔离</strong>：每一个微服务之间互相隔离配置，每一个微服务都创建自己的命名空间，只加载自己明明空间下的所有配置。</p>
</li>
<li><p>配置集：所有的配置的集合。</p>
</li>
<li><p>配置集id：类似于文件名。就是Data ID</p>
</li>
<li><p>配置分组：默认所有配置集都属于：DEFAULT_GROUP</p>
<p><strong>每个微服务创建自己的命名空间，使用配置分组区分环境。</strong> 分组：dev、prod</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.nacos.config.group</span>=<span class="string">dev Group名</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>同时加载多个配置集</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置集id</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.ext-config[0].data-id</span>=<span class="string">datasource.yml</span></span><br><span class="line"><span class="comment"># 配置分组</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.ext-config[0].group</span>=<span class="string">dev</span></span><br><span class="line"><span class="comment"># 启动配置刷新</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.ext-config[0].refresh</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.ext-config[1].data-id</span>=<span class="string">mybatis.yml</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.ext-config[1].group</span>=<span class="string">dev</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.ext-config[1].refresh</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">...</span></span><br></pre></td></tr></table></figure>

<ol>
<li>微服务任何配置信息，任何配置文件都可以放在配置中心中。</li>
<li>只需要在bootstrap.properties说明加载配置中心的哪些配置文件即可。</li>
<li>SpringBoot任何方法从配置文件中获取值，都能使用配置中心获取文件。</li>
</ol>
</li>
</ol>
<h3 id="API网关-Gateway"><a href="#API网关-Gateway" class="headerlink" title="API网关 Gateway"></a>API网关 Gateway</h3><p>分布式开发中需要api网关：</p>
<ol>
<li>实时的接受注册中心的服务是否上线，将请求转发到正确的目标服务。</li>
<li>不将登录校验的功能分布到每一个服务上，在网关服务上实现。</li>
</ol>
<p><strong>Gateway简介</strong>：</p>
<p>网关作为流量的入口，常用功能包括 <strong>路由转发、权限校验、限流控制等</strong>，而spring cloud gateway 作为SpringCloud官方推出的第二代网关框架，取代了Zuul网关。</p>
<p>（每秒能处理三万多的请求，请求到达网关，通过断言，是否符合路由规则，然后经过filter路由到指定地方） </p>
<p>学习Gateway，在官方文档中学习与使用。</p>
<p>断言：判断请求是否符合路由规则，符合就经过一系列filter过滤后到达指定地点。</p>
<ol>
<li><p>新建网关项目，仅依赖网关gateway</p>
</li>
<li><p>依赖common工程，注册到common中</p>
</li>
<li><p>统一gateway的spring版本与springcloud版本</p>
</li>
<li><p>开启服务注册发现（配置服务信息）</p>
<p>启动类中添加@EnableDiscoveryClient</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.properties 配置nacos注册中心</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">wmall-gateway</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">88</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bootstrap.properties 配置nacos配置中心</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.namespace</span>=<span class="string">da468fd0-0579-4ac8-b473-f93211213424</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.group</span>=<span class="string">dev</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">wmall-coupon</span></span><br></pre></td></tr></table></figure>

<p>有需要时，在配置中心配置</p>
<p>启动网关的时候会遇到数据源相关的错误，网关排除掉跟数据库相关的自动配置 @SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</p>
<p>网关是基于Netty启动的。</p>
<p>请求转发：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">test_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.baidu.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=baz</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">qq_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.qq.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=url,</span> <span class="string">qq</span></span><br></pre></td></tr></table></figure>

<p>浏览器输入localhost:88/?baz 会跳转到百度页面</p>
<p>输入localhost:88/?url=qq 会跳转到qq页面</p>
</li>
</ol>
<h1 id="项目问题待解决"><a href="#项目问题待解决" class="headerlink" title="项目问题待解决"></a>项目问题待解决</h1><h3 id="Maven-plugins-爆红，无法导入"><a href="#Maven-plugins-爆红，无法导入" class="headerlink" title="Maven plugins 爆红，无法导入"></a>Maven plugins 爆红，无法导入</h3><h3 id="springcloud版本问题"><a href="#springcloud版本问题" class="headerlink" title="springcloud版本问题"></a>springcloud版本问题</h3><p>已解决，我已经全部换成:</p>
<p>spring-boot-starter-parent 2.1.3.RELEASE</p>
<p>spring-cloud.version Greenwich.SR3</p>
<ol>
<li><p>gulimall-common</p>
</li>
<li><p>gulimall-coupon<br>spring-boot-starter-parent 2.4.1<br>spring-cloud.version 2020.0.0-M6</p>
</li>
<li><p>gulimall-member<br>spring-boot-starter-parent 2.3.4.RELEASE<br>spring-cloud.version Greenwich.SR3</p>
</li>
<li><p>gulimall-order</p>
<p>spring-boot-starter-parent 2.4.1<br>spring-cloud.version 2020.0.0-M6</p>
</li>
<li><p>gulimall-product</p>
<p>spring-boot-starter-parent 2.3.5.RELEASE<br>spring-cloud.version Greenwich.SR3</p>
</li>
<li><p>gulimall-ware</p>
<p>spring-boot-starter-parent 2.4.1<br>spring-cloud.version 2020.0.0-M6</p>
</li>
</ol>
<h3 id="Java解决Excel（POI）"><a href="#Java解决Excel（POI）" class="headerlink" title="Java解决Excel（POI）"></a>Java解决Excel（POI）</h3><p>已解决，如果maven阿里云仓库没有最新的依赖，阿里云将会去国外中央仓库下载</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/12/Tomcat%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QB">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="genuine nonage">
      <meta itemprop="description" content="菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | genuine nonage">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/10/12/Tomcat%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">tomcat问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-10-12 17:01:00" itemprop="dateCreated datePublished" datetime="2020-10-12T17:01:00+08:00">2020-10-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-02-08 15:31:05" itemprop="dateModified" datetime="2021-02-08T15:31:05+08:00">2021-02-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="乱码问题"><a href="#乱码问题" class="headerlink" title="乱码问题"></a>乱码问题</h3><h5 id="springmvc启动tomcate控制台乱码问题"><a href="#springmvc启动tomcate控制台乱码问题" class="headerlink" title="springmvc启动tomcate控制台乱码问题"></a>springmvc启动tomcate控制台乱码问题</h5><p>在tomcat文件夹中的conf包下的logging.properties中找到</p>
<p>java.util.logging.ConsoleHandler.encoding = UTF-8</p>
<p>将这行代码注销改为</p>
<p>java.util.logging.ConsoleHandler.encoding = GBK</p>
<p>重启tomcat即可！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/21/java/Java8%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="QB">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="genuine nonage">
      <meta itemprop="description" content="菜鸡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | genuine nonage">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/21/java/Java8%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7/" class="post-title-link" itemprop="url">Java8的新特性</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-09-21 07:31:00" itemprop="dateCreated datePublished" datetime="2020-09-21T07:31:00+08:00">2020-09-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-02-08 15:51:01" itemprop="dateModified" datetime="2021-02-08T15:51:01+08:00">2021-02-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>新增了非常多的特性，主要有：</p>
<ul>
<li><strong>Lambad表达式</strong>：Lambda 允许把函数作为一个方法的参数（函数作为参数传递到方法中）。</li>
<li><strong>方法引用</strong>：可以直接引用已有Java类或对象（实例）的方法或构造器。与lambda联合，使语言的构造更紧凑简洁，减少冗余代码。</li>
<li><strong>默认方法</strong>：默认方法就是一个在接口里面有了一个实现的方法。</li>
<li><strong>StreamAPI</strong>：新添加的Stream API（java.util.stream） 把真正的函数式编程风格引入到Java中。</li>
<li><strong>DateTimeAPI</strong>：加强对日期与时间的处理。</li>
<li><strong>Optional类</strong>：Optional 类已经成为 Java 8 类库的一部分，用来解决空指针异常。</li>
<li><strong>Nashorn，JavaScript引擎</strong>：Java 8提供了一个新的Nashorn javascript引擎，它允许我们在JVM上运行特定的javascript应用。</li>
</ul>
<h3 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a>Lambda表达式</h3><p>Lambda 表达式，也可称为闭包，它是推动 Java 8 发布的最重要新特性。</p>
<p>Lambda 允许把函数作为一个方法的参数（函数作为参数传递进方法中）。</p>
<ol>
<li><p>接收2个int型整数,返回他们的和<br>(int x, int y) -&gt; x + y  </p>
</li>
<li><p>接受2个参数(数字),并返回他们的差值<br>(x, y) -&gt; x – y  </p>
</li>
<li><p>接受一个 string 对象,并在控制台打印,不返回任何值(看起来像是返回void)<br>(String s) -&gt; System.out.print(s)</p>
<pre><code> public class Java8Tester &#123;
    public static void main(String args[])&#123;
       Java8Tester tester = new Java8Tester();
         
       // 类型声明
       MathOperation addition = (int a, int b) -&gt; a + b;
         
       // 不用类型声明
       MathOperation subtraction = (a, b) -&gt; a - b;
         
       // 大括号中的返回语句
       MathOperation multiplication = (int a, int b) -&gt; &#123; return a * b; &#125;;
         
       // 没有大括号及返回语句
       MathOperation division = (int a, int b) -&gt; a / b;
         
       System.out.println(&quot;10 + 5 = &quot; + tester.operate(10, 5, addition));
       System.out.println(&quot;10 - 5 = &quot; + tester.operate(10, 5, subtraction));
       System.out.println(&quot;10 x 5 = &quot; + tester.operate(10, 5, multiplication));
       System.out.println(&quot;10 / 5 = &quot; + tester.operate(10, 5, division));
         
       // 不用括号
       GreetingService greetService1 = message -&gt;
       System.out.println(&quot;Hello &quot; + message);
         
       // 用括号
       GreetingService greetService2 = (message) -&gt;
       System.out.println(&quot;Hello &quot; + message);
         
       greetService1.sayMessage(&quot;Runoob&quot;);
       greetService2.sayMessage(&quot;Google&quot;);
    &#125;
     
    interface MathOperation &#123;
       int operation(int a, int b);
    &#125;
     
    interface GreetingService &#123;
       void sayMessage(String message);
    &#125;
     
    private int operate(int a, int b, MathOperation mathOperation)&#123;
       return mathOperation.operation(a, b);
    &#125;
 &#125;
</code></pre>
</li>
</ol>
<h3 id="方法引用"><a href="#方法引用" class="headerlink" title="方法引用"></a>方法引用</h3><p>方法引用通过方法的名字来指向一个方法。</p>
<p>方法引用使用一对冒号 :: 。</p>
<ul>
<li><p>构造器引用：它的语法是Class::new，或者更一般的Class&lt; T &gt;::new</p>
<ul>
<li>实例如下：<br>final Car car = Car.create( Car::new );<br>final List&lt; Car &gt; cars = Arrays.asList( car );</li>
</ul>
</li>
<li><p>静态方法引用：它的语法是Class::static_method</p>
<ul>
<li>实例如下：<br>cars.forEach( Car::collide );</li>
</ul>
</li>
<li><p>特定类的任意对象的方法引用：它的语法是Class::method</p>
<ul>
<li>实例如下：<br>cars.forEach( Car::repair );</li>
</ul>
</li>
<li><p>特定对象的方法引用：它的语法是instance::method</p>
<ul>
<li><p>实例如下：<br>final Car police = Car.create( Car::new );<br>cars.forEach( police::follow );</p>
<pre><code>  public class Java8Tester &#123;
     public static void main(String args[])&#123;
        List names = new ArrayList();
          
        names.add(&quot;Google&quot;);
        names.add(&quot;Runoob&quot;);
        names.add(&quot;Taobao&quot;);
        names.add(&quot;Baidu&quot;);
        names.add(&quot;Sina&quot;);
          
        names.forEach(System.out::println);
     &#125;
  &#125;
  实例中我们将 System.out::println 方法作为静态方法来引用。
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h3><p>函数式接口(Functional Interface)就是一个有且仅有一个抽象方法，但是可以有多个非抽象方法的接口。</p>
<p>函数式接口可以被隐式转换为 lambda 表达式。</p>
<pre><code>@FunctionalInterface
interface GreetingService 
&#123;
    void sayMessage(String message);
&#125;
</code></pre>
<p>使用Lambda表达式来表示该接口的一个实现(注：JAVA 8 之前一般是用匿名类实现的)：</p>
<pre><code>GreetingService greetService1 = message -&gt; System.out.println(&quot;Hello &quot; + message);
</code></pre>
<h3 id="默认方法"><a href="#默认方法" class="headerlink" title="默认方法"></a>默认方法</h3><p>新增了接口的默认方法。</p>
<p>接口可以有实现方法，不需要实现类去实现其方法。</p>
<p>只需在方法名前面加个 default 关键字即可实现默认方法。</p>
<h4 id="静态默认方法"><a href="#静态默认方法" class="headerlink" title="静态默认方法"></a>静态默认方法</h4><p>Java 8 的另一个特性是接口可以声明（并且可以提供实现）静态方法。</p>
<pre><code>public interface Vehicle &#123;
   default void print()&#123;
      System.out.println(&quot;我是一辆车!&quot;);
   &#125;
    // 静态方法
   static void blowHorn()&#123;
      System.out.println(&quot;按喇叭!!!&quot;);
   &#125;
&#125;
</code></pre>
<h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><p>添加了一个新的抽象称为流Stream，可以让你以一种声明的方式处理数据。</p>
<p>Stream 使用一种类似用 SQL 语句从数据库查询数据的直观方式来提供一种对 Java 集合运算和表达的高阶抽象。</p>
<h4 id="什么是-Stream？"><a href="#什么是-Stream？" class="headerlink" title="什么是 Stream？"></a>什么是 Stream？</h4><p>Stream（流）是一个来自数据源的元素队列并支持聚合操作。</p>
<ul>
<li>元素是特定类型的对象，形成一个队列。 Java中的Stream并不会存储元素，而是按需计算。</li>
<li>数据源 流的来源。 可以是集合，数组，I/O channel， 产生器generator 等。</li>
<li>聚合操作 类似SQL语句一样的操作， 比如filter, map, reduce, find, match, sorted等。</li>
<li>Pipelining: 中间操作都会返回流对象本身。 这样多个操作可以串联成一个管道， 如同流式风格（fluent style）。 这样做可以对操作进行优化， 比如延迟执行(laziness)和短路( short-circuiting)。</li>
<li>内部迭代： 以前对集合遍历都是通过Iterator或者For-Each的方式, 显式的在集合外部进行迭代， 这叫做外部迭代。 Stream提供了内部迭代的方式， 通过访问者模式(Visitor)实现。</li>
</ul>
<h4 id="生成流"><a href="#生成流" class="headerlink" title="生成流"></a>生成流</h4><p>在 Java 8 中, 集合接口有两个方法来生成流：</p>
<ul>
<li>stream()  为集合创建串行流。</li>
<li>parallelStream()  为集合创建并行流。</li>
</ul>
<h3 id="Optional类"><a href="#Optional类" class="headerlink" title="Optional类"></a>Optional类</h3><ul>
<li>一个可以为null的容器对象。如果值存在则isPresent()方法会返回true，调用get()方法会返回该对象。</li>
<li>Optional 是个容器：它可以保存类型T的值，或者仅仅保存null。Optional提供很多有用的方法，这样我们就不用显式进行空值检测。 </li>
<li>Optional 类的引入很好的解决空指针异常。</li>
</ul>
<h3 id="日期时间API"><a href="#日期时间API" class="headerlink" title="日期时间API"></a>日期时间API</h3><p>通过发布新的Date-Time API  加强对日期与时间的处理。 </p>
<p>旧版日期时间API问题：</p>
<ul>
<li>非线程安全：java.util.Date 是非线程安全的，所有的日期类都是可变的，这是Java日期类最大的问题之一。</li>
<li>设计很差：Java的日期/时间类的定义并不一致，在java.util和java.sql的包中都有日期类，此外用于格式化和解析的类在java.text包中定义。java.util.Date同时包含日期和时间，而java.sql.Date仅包含日期，将其纳入java.sql包并不合理。另外这两个类都有相同的名字。</li>
<li>时区处理麻烦：日期类并不提供国际化，没有时区支持。</li>
</ul>
<p>Java 8 在 java.time 包下提供了很多新的 API。以下为两个比较重要的 API：</p>
<ul>
<li>Local(本地) − 简化了日期时间的处理，没有时区的问题。</li>
<li>Zoned(时区) − 通过制定的时区处理日期时间。</li>
</ul>
<h4 id="本地化日期时间API"><a href="#本地化日期时间API" class="headerlink" title="本地化日期时间API"></a>本地化日期时间API</h4><p>LocalDate/LocalTime 和 LocalDateTime 类可以在处理时区不是必须的情况。</p>
<h4 id="时区的时间日期API"><a href="#时区的时间日期API" class="headerlink" title="时区的时间日期API"></a>时区的时间日期API</h4><p>需要考虑到时区，就可以使用时区的日期时间API。</p>
<pre><code>public void testZonedDateTime()&#123;
    
  // 获取当前时间日期
  ZonedDateTime date1 = ZonedDateTime.parse(&quot;2015-12-03T10:15:30+05:30[Asia/Shanghai]&quot;);
  System.out.println(&quot;date1: &quot; + date1);
    
  ZoneId id = ZoneId.of(&quot;Europe/Paris&quot;);
  System.out.println(&quot;ZoneId: &quot; + id);
    
  ZoneId currentZone = ZoneId.systemDefault();
  System.out.println(&quot;当期时区: &quot; + currentZone);
</code></pre>
<p>   }</p>
<h3 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h3><p>在Java 8中，Base64编码已经成为Java类库的标准。</p>
<p>Java 8 内置了 Base64 编码的编码器和解码器。</p>
<p>Base64工具类提供了一套静态方法获取下面三种BASE64编解码器：</p>
<ul>
<li>基本：输出被映射到一组字符A-Za-z0-9+/，编码不添加任何行标，输出的解码仅支持A-Za-z0-9+/。</li>
<li>URL：输出映射到一组字符A-Za-z0-9+_，输出是URL和文件。</li>
<li>MIME：输出隐射到MIME友好格式。输出每行不超过76字符，并且使用’\r’并跟随’\n’作为分割。编码输出最后没有行分割。</li>
</ul>
<h4 id="内嵌类"><a href="#内嵌类" class="headerlink" title="内嵌类"></a>内嵌类</h4><ol>
<li>static class Base64.Decoder  该类实现一个解码器用于，使用 Base64 编码来解码字节数据。</li>
<li>static class Base64.Encoder  该类实现一个编码器，使用 Base64 编码来编码字节数据。</li>
</ol>
<p>有多个get方法使用。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">QB</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"genuinenonage/comments","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
