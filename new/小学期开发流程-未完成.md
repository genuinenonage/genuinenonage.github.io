---
title: 小学期开发流程
date: 2020/08/20 09:49:00
tags: 
- 学校
categories:
- 学校
---
# 8-20  
使用X-admin前端框架。  
layui前端框架

登录验证接口（注意前端配置不要被拦截）

编写分页工具类，添加分页接口

controller/@Controller
	@Autowired
	// 服务
	
	@PostMapper("url")
	@ResponseBody
	// 接口方法
config/@Configuration
service/impl/@Service
mapper/@Repository

# 8-21  
adminController
adminMapper
xml
adminService

ctrl+f9 重新编译

layui的使用

用户管理：启用，编辑，删除。

自行设计商品表：图片上传，订单管理。

周六
	主任：综合实训相关
周日
	柱子：问转正相关
周一
* 强：互联互通只是使用了最基本的springboot框架的项目，之后是否会使用多个现在主流的技术添加到这个项目中。  
* his：开发困难吗？


# 8-24  
商品管理：新增修改删除上架描述
上传图片（获取文件类型并设置uuid，multipartFile.transferTo io操作
校验后缀名：把允许的文件格式放到一个数组里）。  
在MyWebMvcConfigurer中设置拦截。
 
要学会： layui传递数据信息，页面html，，日期设置，图片  

1. 首先public ResultDTO upload()接口
2. 文件存磁盘， .properties 文件保存路径，地址映射
3. MyWebMvcConfigurer 注册静态资源映射
4. 拦截器放行资源
5. 提交表单时间戳转换器。

ctrl+f9 重新编译
# 8-25  
错误页面定制  
1. 构建错误页面
2. 重启方法，设计错误页面传递的数据。
3. jsr-303 规范 @xxx 必须满足注解的验证规则。
ErrorMvcAutoConfiguration 错误页面自动装配类

连个重要的方法errorHtml error 

发送/error的请求

返回：字符串拼接的html 

操作：
1. 在templates下创建error/404.html

	404.html
	<h1>404</h1>
	<h3 th:text="${timestamp}"></h3>
	<h3 th:text="${status}"></h3>
	<h3 th:text="${message}"></h3>  

	//message没有数据？
	敏感信息被被删除。返回空。

	4xx.html  代表所有没有专门处理页面的400的错误页面
	<h1>4xx</h1>  

在exception/GlobleException.java
定义一个异常类extends RuntimeException{}
	public GlobleException(Stirng message){
		 super(message);

定义类：@ControllerAdvice p c MyExceptionHandler{}

	@ExceptionHandler(value = {GlobleException.class})  //捕获这个异常
	public String exceptionHandler(Exception e, HttpServletRequest request){
		Map<String,String> map = new HashMap<>();
		map.put("massage",e.getMessage());
		request.setAttributes("java.servlet.error.status_code",500);
		new ResultDTO(9999,e.getMessage(),null)
		request.setAttributes("msg",e.getMessage());
		return "forward:/error";	
		
		没有发送错误状态，结果为200。


throw new GlobleException("自定义异常类");
	 
@Component //加入容器中
MyErrorAttributes类extends EdfaultErrorAttributes重写getErrorAttributes方法
	Map<String,Object> errorAttribute = super.getErrorAttributes(webRequest);
	webRequest.getAttributes("msg",RequestAttributes.SCOPE_REQUEST);
	errorAttributes.put("msg","123");
	return errorAttributes;

	error: funtion(res){
		layer.msg(res.responseJSON.resultDTO.msg);

	throw new GlobleException("失败")

	<dependency>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-validation</artifactId>
	</dependency>


	ProductControler.java
	public ResultDTO add(@Valid Product product.BindingResult res){
		
		for(FieldError f:fieldErrors){
			System.out.println(f.getField()+"--"+f.getDefaultValue);
		ResultDTO result = productService.save(product);


 		@ExceptionHandler(value={Exception.class})
		public String exceptionHandler1(Exception e, HttpServletRequest request){
			if(e instanceof GlobleException){
				request.setAttribute("javax.servlet.error.status_code",500);
				ResultDTO resultDTO = new ResultDTO(9999,e.getMessage(),null);
				request.setAttribute("resultDTO",resultDTO);
			}else{
				request.setAttribute("javax.servlet.error.status_code",500);
				ResultDTO resultDTO = new ResultDTO(8888,"系统异常",null);
				request.setAttribute("resultDTO",resultDTO);
			}
			return "forward:/error";


# 8-26  
#### 权限管理模块  
#### 什么是权限管理  
使用基于web的RBAC:基于角色与基于资源     
role based access control    
resources based access control    
Role：系统的角色（超级管理员，订单管理员，商品管理员。。。）  
Resource：资源（可以从系统中可以获取的数据--> 可以从系统中调用的接口API）  
URL：统一资源定位符  
所以在设计权限管理的架构中：  
用户<=（关联）=>角色<===>资源（url）  
系统想要知道用户拥有的角色  
1. 通过用户找到对应角色，角色找到可使用的权限。  

#### 数据库设计  
##### 设计几张表？  
1. Admin表： 管理员表
2. Role表： 角色表  
3. Permissions表： 权限表  

##### 表间的关系：  
Admin和Role之间的关系： 多对多  
需要一个中间表。  admin_role
Role表的结构：  
1. id：自增id
2. role_name
3. role_desc：角色描述
4. status：状态：1 正常，0 锁定 
5. is_delete：是否删除：1 删除，0 未删除
6. create_time
7. update_time  

所有的表都不建外键。   
admin_role关系表：
1. id：自增id
2. admin_id
3. role_id

Role和Permissions的关系：多对多的关系  
中间表role_premissions  
权限分类：  
* 菜单权限：能看见的菜单
* 操作权限：能进行的操作(CURD...)
Permissions表结构：  
1. id
2. permission_name：权限的名字
3. permission_url：权限的规则（url）
4. is_menu：是否是菜单，1 菜单，2 非菜单  
5. permission_level：权限的等级 1 2 3 4...
6. parent_id：父级ID
7. is_delete
8. create_time
9. update_time

	select a.admin_name, r.role_name, p.permission_name, p.permission_url from admin a
	left join admin_role ar on a.id=ar.admin_id
	left join role r on r.id=ar.role_id

# 8-27  
is_mnue == 1显示在菜单项；0不显示在菜单项  
### 菜单权限  
用户登录进入系统之后所拥有的操作菜单。
实现菜单权限：  

1. 如何把权限查询出来？
	1. 5表关联查询。
	2. mybatis多表关联查询
	3. 从业务角度：
		1. 用户登录的时候，把相关的角色和权限查询出来，保存到session中。


2. 如何把菜单显示出来？


<collection property="roles" column="id" ofType="com.drdx.cssy.pojo.Role"
select="com.drdx.cssy.mapper.adminRoleMapper.findAdminRole"/>